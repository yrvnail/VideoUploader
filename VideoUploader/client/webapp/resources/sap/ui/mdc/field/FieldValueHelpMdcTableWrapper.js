/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/field/FieldValueHelpTableWrapperBase',"sap/ui/mdc/util/loadModules","sap/base/util/deepEqual","sap/ui/mdc/library","sap/ui/mdc/enum/PersistenceMode","sap/ui/mdc/p13n/Engine"],function(F,l,d,a,P,E){"use strict";var S=a.SelectionMode;var _={"Table":"sap/ui/mdc/field/FieldValueHelpUITableWrapper","ResponsiveTable":"sap/ui/mdc/field/FieldValueHelpMTableWrapper"};var b=F.extend("sap.ui.mdc.field.FieldValueHelpMdcTableWrapper",{metadata:{library:"sap.ui.mdc",aggregations:{table:{type:"sap.ui.mdc.Table",multiple:false}},defaultAggregation:"table"}});b.prototype.init=function(){F.prototype.init.apply(this,arguments);this.OInnerWrapperClass=null;};b.prototype.setParent=function(p,A){if(p){E.getInstance().defaultProviderRegistry.attach(p,P.Transient);}F.prototype.setParent.apply(this,arguments);};b.prototype._getStringType=function(){var t=this.getTable();var T,o=T=t&&t.getType();if(!o){T="Table";}else if(typeof o==="object"){if(o.isA("sap.ui.mdc.table.ResponsiveTableType")){T="ResponsiveTable";}else{T="Table";}}return T;};b.prototype.fieldHelpOpen=function(s){var t=this.getTable();if(t){if(this.OInnerWrapperClass){return this.OInnerWrapperClass.prototype.fieldHelpOpen.call(this,s);}}return this;};b.prototype._updateInnerWrapperClass=function(){var t=this._getStringType();var M=_[t];if(M&&this._sInnerWrapperType!==t){this._sInnerWrapperType=t;if(this.OInnerWrapperClass){this.OInnerWrapperClass.dispose.apply(this);this.OInnerWrapperClass=null;}this._oInnerWrapperClassPromise=l(M).then(function(e){this.OInnerWrapperClass=e[0];this.OInnerWrapperClass.prototype.initialize.apply(this);}.bind(this));}};b.prototype._adjustTable=function(s){var t=this.getTable();if(t){var p=this.getParent();if(p){t.setHeight("100%");t.setSelectionMode(this._getMaxConditions()===1?S.Single:S.Multi);}if(this.OInnerWrapperClass){this.OInnerWrapperClass.prototype._adjustTable.call(this,s);}}};b.prototype.exit=function(){var p=this.getParent();if(p){E.getInstance().defaultProviderRegistry.detach(p);}this._oCurrentConditions=null;this._bSuggestion=null;if(this._oInnerWrapperClassPromise){this._oInnerWrapperClassPromise=null;}if(this.OInnerWrapperClass){this.OInnerWrapperClass=null;}this._sInnerWrapperType=null;F.prototype.exit.apply(this,arguments);};b.prototype.getListBinding=function(){var t=this.getTable();return t&&t.getRowBinding();};var m={onmouseover:function(e){var i=jQuery(e.target).control(0);if(i&&i.isA("sap.m.ColumnListItem")){i.setType("Active");}}};var c=function(t,A){if(A){t.addDelegate(m,true,this);return;}t.removeDelegate(m);};b.prototype._handleTableChanged=function(M,t){var i;if(M==="insert"){this._updateInnerWrapperClass();c.call(this,t,true);i=this._getWrappedTable();if(i){this._handleInnerTableChanged("insert",i);}this._oObserver.observe(t,{aggregations:["_content"]});}else{c.call(this,t);i=t._oTable;if(i){this._handleInnerTableChanged(M,i);}this._oObserver.unobserve(t);}};b.prototype._handleToolbarExtensions=function(i){if(i.mAggregations["extension"]&&i.mAggregations["extension"].length){i.getAggregation("extension").forEach(function(e){e.setVisible(false);});}if(i.mAggregations["headerToolbar"]){var t=i.getAggregation("headerToolbar");t.setVisible(false);}};b.prototype._handleInnerTableChanged=function(M,i){if(M==="insert"){this._updateInnerWrapperClass();this._handleToolbarExtensions(i);this._oObserver.observe(i,{bindings:["rows"]});}this._oInnerWrapperClassPromise.then(function(){this.OInnerWrapperClass.prototype._handleTableChanged.call(this,M,i);this.getTable().initialized().then(function(){this.fireDataUpdate({contentChange:true});}.bind(this));}.bind(this));};b.prototype.applyFilters=function(f,s,o){var t=this.getTable();if(t&&o){if(t.getFilter()!==o.getId()){t.setFilter(o);}this._oCurrentConditions=this._oCurrentConditions||{};var C=o.getConditions();if(!d(this._oCurrentConditions,C)||(t._oTable&&t._oTable.getShowOverlay())){t.initialized().then(function(){this._oCurrentConditions=C;this._handleScrolling();o.triggerSearch();}.bind(this));}var L=this.getListBinding();if(L&&L.isSuspended()){L.resume();}else if(!L){this._oTablePromise.then(function(t){if(!this._bIsBeingDestroyed){this.applyFilters(f,s,o);}}.bind(this));this.restoreBinding();}}};b.prototype._observeChanges=function(C,n){if(C.name==="_content"){this._handleInnerTableChanged(C.mutation,C.child);}if(this.OInnerWrapperClass){this.OInnerWrapperClass.prototype._observeChanges.call(this,C,true);}else{F.prototype._observeChanges.call(this,C,true);}};b.prototype._handleUpdateFinished=function(e){return this.OInnerWrapperClass.prototype._handleUpdateFinished.apply(this,arguments);};b.prototype._handleEvents=function(e){if(this.OInnerWrapperClass){return this.OInnerWrapperClass.prototype._handleEvents.apply(this,arguments);}};b.prototype._handleItemPress=function(e){return this.OInnerWrapperClass.prototype._handleItemPress.apply(this,arguments);};b.prototype._handleSelectionChange=function(e){var i=this._isTableReady();return this._bIsModifyingTableSelection||!i?undefined:this._fireSelectionChange.call(this,false);};b.prototype._getTableItems=function(s,n){return this.OInnerWrapperClass.prototype._getTableItems.apply(this,arguments);};b.prototype._modifyTableSelection=function(i,I,s,e){return this.OInnerWrapperClass.prototype._modifyTableSelection.apply(this,arguments);};b.prototype._getDataFromItem=function(i,I,o){return this.OInnerWrapperClass.prototype._getDataFromItem.apply(this,arguments);};b.prototype._handleTableEvent=function(e){return this.OInnerWrapperClass.prototype._handleTableEvent.apply(this,arguments);};b.prototype._isTableReady=function(){var t=this._getWrappedTable();if(t&&t._bInvalid){return false;}return F.prototype._isTableReady.apply(this,arguments);};b.prototype._getWrappedTable=function(){var t=this.getTable();return t&&t._oTable;};b.prototype._handleScrolling=function(){return this.OInnerWrapperClass.prototype._handleScrolling.apply(this,arguments);};b.prototype.getDialogContent=function(){if(this.OInnerWrapperClass){return this.OInnerWrapperClass.prototype.getDialogContent.apply(this,arguments);}};b.prototype.initialize=function(){if(this.OInnerWrapperClass){return this.OInnerWrapperClass.prototype.initialize.apply(this,arguments);}};b.prototype.getSuggestionContent=function(){return this.getTable();};b.prototype.restoreBinding=function(){var t=this.getTable();if(t){t.checkAndRebind();}};return b;});
