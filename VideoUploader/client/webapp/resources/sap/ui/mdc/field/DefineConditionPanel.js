/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/base/ManagedObjectObserver','sap/base/util/merge','sap/base/util/deepEqual','sap/ui/mdc/condition/Condition','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/condition/Operator','sap/ui/mdc/enum/EditMode','sap/ui/mdc/enum/FieldDisplay','sap/ui/mdc/enum/BaseType','sap/ui/mdc/enum/ConditionValidated','sap/ui/mdc/Field','sap/ui/mdc/field/ListFieldHelp','sap/ui/mdc/field/ListFieldHelpItem','sap/ui/model/base/ManagedObjectModel','sap/ui/model/json/JSONModel','sap/ui/model/resource/ResourceModel','sap/ui/model/type/String','sap/ui/core/library','sap/ui/core/InvisibleText','sap/ui/core/ListItem','sap/ui/layout/Grid','sap/ui/layout/GridData','sap/m/library','sap/m/ScrollContainer','sap/m/Button','sap/m/Panel'],function(C,M,m,d,a,F,O,E,b,B,c,e,L,f,g,J,R,S,h,I,j,G,k,l,o,p,P){"use strict";var q=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");sap.ui.getCore().attachLocalizationChanged(function(){q=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");});var r=l.ButtonType;var V=h.ValueState;var D=C.extend("sap.ui.mdc.field.DefineConditionPanel",{metadata:{library:"sap.ui.mdc",properties:{conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},formatOptions:{type:"object",defaultValue:{}},label:{type:"string",defaultValue:""},inputOK:{type:"boolean",defaultValue:true}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{}},_oManagedObjectModel:null,renderer:{apiVersion:2,render:function(i,n){i.openStart("section",n);i.class("sapUiMdcDefineConditionPanel");i.openEnd();i.renderControl(n.getAggregation("_content"));i.close("section");}},init:function(){sap.ui.getCore().getMessageManager().registerObject(this,true);C.prototype.init.apply(this,arguments);this._oManagedObjectModel=new g(this);this._oObserver=new M(_.bind(this));this._oObserver.observe(this,{properties:["conditions","formatOptions"]});T.call(this);this.setModel(this._oManagedObjectModel,"$this");this.setModel(this._oManagedObjectModel,"$condition");},exit:function(){sap.ui.getCore().getMessageManager().unregisterObject(this,true);this._oObserver.disconnect();this._oObserver=undefined;if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null;}if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;},byId:function(i){return sap.ui.getCore().byId(this.getId()+"--"+i);},onBeforeRendering:function(){if(!this.getModel("$i18n")){this.setModel(new R({bundleName:"sap/ui/mdc/messagebundle",async:false}),"$i18n");}if(this.getConditions().length===0){this.updateDefineConditions();}},removeCondition:function(n){var j1=n.oSource;var k1=j1.getBindingContext("$this");var l1=this.getConditions();var m1=k1.getPath();var n1=m1.match(/^.*\/(\d+)\/$/);var o1;if(n1){o1=parseInt(n1[1]);}if(o1>0&&l1.length-1===o1){this._bFocusLastRemoveBtn=true;}var p1=this.byId("conditions");var q1=p1.getContent();var r1=0;for(var i=0;i<q1.length&&r1<=o1;i++){var s1=q1[i];if(r1===o1&&s1 instanceof e&&s1.hasOwnProperty("_iValueIndex")){if(s1._bParseError){s1.setValue(null);jQuery(s1.getFocusDomRef()).val("");s1._bParseError=false;}if(s1.getValueState()!==V.None){s1.setValueState(V.None);s1.setValueStateText();}}if(s1 instanceof p&&s1.getId().endsWith("-removeBtnLarge")){r1++;}}l1.splice(o1,1);this.setProperty("conditions",l1,true);},addCondition:function(i){var n=this.getConditions();var j1=this.getFormatOptions();var k1=j1.maxConditions;if(k1===-1||n.length<k1){this.addDummyCondition(n.length+1);if(this.getConditions().length===k1){this._bFocusLastCondition=true;}}},addDummyCondition:function(i){var n=x.call(this);var j1=w.call(this);var k1=j1.name;var l1=a.createCondition(k1,j1.valueDefaults?j1.valueDefaults:[],undefined,undefined,c.NotValidated);l1.isInitial=true;F.updateConditionValues(l1);F.checkConditionsEmpty(l1,n);var m1=this.getConditions();if(i!==undefined){m1.splice(i,0,l1);}else{m1.push(l1);}this.setProperty("conditions",m1,true);},updateDefineConditions:function(){var i=this.getConditions().filter(function(n){var j1=F.getOperator(n.operator);return n.validated!==c.Validated||j1.exclude;});Q.call(this,i,true,false);if(i.length===0){this.addDummyCondition();}},onChange:function(i){var n=x.call(this);var j1=this.getConditions();F.checkConditionsEmpty(j1,n);F.updateConditionsValues(j1,n);if(i){j1.forEach(function(k1){if(!k1.isEmpty){delete k1.isInitial;}});}this.setProperty("conditions",j1,true);},onSelectChange:function(i){var n=i.getSource();var j1=n.getValue();var k1=n._sOldKey;var l1=F.getOperator(j1);var m1=k1&&F.getOperator(k1);if(l1&&m1){var n1=false;var o1=n.getBindingContext("$this").getObject();var p1=this.getConditions();var q1=F.indexOfCondition(o1,p1);if(!d(l1.valueTypes[0],m1.valueTypes[0])&&l1.valueTypes[0]!==O.ValueType.Static){if(q1>=0){o1=p1[q1];o1.values.forEach(function(s1,t1){if(s1!==null){o1.values[t1]=null;n1=true;}});}}if(q1>=0&&l1.valueDefaults){var r1=false;o1=p1[q1];o1.values.forEach(function(s1,t1){if((o1.isInitial&&s1!==l1.valueDefaults[t1])||(s1===null)){o1.values[t1]=l1.valueDefaults[t1];o1.isInitial=true;n1=true;r1=true;}});if(r1){F.checkConditionsEmpty(o1,x.call(this));}}if(!l1.valueTypes[1]&&m1.valueTypes[1]){if(q1>=0){o1=p1[q1];if(o1.values.length>1&&o1.values[1]){o1.values=o1.values.slice(0,1);n1=true;}}}if(n1){this.setProperty("conditions",p1,true);}}delete n._sOldKey;},onPaste:function(n){var j1;var k1=n.srcControl;var l1=this.getFormatOptions();var m1=l1.hasOwnProperty("maxConditions")?l1.maxConditions:-1;var n1=k1.getBindingContext("$condition").getPath();var o1=parseInt(n1.split("/")[2]);if(window.clipboardData){j1=window.clipboardData.getData("Text");}else{j1=n.originalEvent.clipboardData.getData('text/plain');}var p1=j1.split(/\r\n|\r|\n/g);if(p1&&p1.length>1){setTimeout(function(){var q1=A.call(this);var r1=p1.length;var s1=this.getConditions();for(var i=0;i<r1;i++){if(p1[i]){var t1=p1[i];var u1=t1.split(/\t/g);var v1;if(u1.length==2&&u1[0]&&u1[1]){v1=F.getOperator("BT");}else{u1=[t1.trim()];v1=w.call(this);}t1=v1?v1.format(a.createCondition(v1.name,u1)):u1[0];if(v1){var w1=v1.getCondition(t1,q1,b.Value,true);if(w1){w1.validated=c.NotValidated;if(s1.length>o1){s1.splice(o1,1,w1);}else{s1.push(w1);}o1++;}}}}if(m1>=0&&s1.length>m1){s1.splice(m1,s1.length-m1);}if(k1.setDOMValue){k1.setDOMValue("");}F.checkConditionsEmpty(s1);this.setProperty("conditions",s1,true);}.bind(this),0);}},cleanUp:function(){var n=this.byId("conditions");var j1=n.getContent();for(var i=0;i<j1.length;i++){var k1=j1[i];if(k1 instanceof e&&k1.hasOwnProperty("_iValueIndex")){if(k1._bParseError){k1.setValue();}if(k1.getValueState()!==V.None){k1.setValueState(V.None);k1.setValueStateText();}}}this.setProperty("inputOK",true,true);}});function _(i){if(i.name==="value"){s.call(this,i.object,i.current,i.old);}if(i.name==="formatOptions"){var n=this.getConditions();var j1=i.current&&i.current.operators;var k1=i.old&&i.old.operators;var l1=false;if(!d(j1,k1)){l1=true;z.call(this);}var m1=i.current&&i.current.valueType&&i.current.valueType.getMetadata().getName();var n1=i.old&&i.old.valueType&&i.old.valueType.getMetadata().getName();if(m1!==n1&&n.length>0){if(!l1){z.call(this);}this._bUpdateType=true;X.call(this);this._bUpdateType=false;Q.call(this,n,true,true);}}if(i.name==="conditions"){if(this._sConditionsTimer){clearTimeout(this._sConditionsTimer);this._sConditionsTimer=null;}this._sConditionsTimer=setTimeout(function(){this._sConditionsTimer=null;this.updateDefineConditions();X.call(this);}.bind(this),0);}}function s(n,j1,k1){n._sOldKey=k1;var l1=0;if(j1&&k1){var m1=F.getOperator(j1);var n1=F.getOperator(k1);var o1=n.getParent();var p1;var q1;l1=o1.indexOfContent(n);p1=o1.getContent()[l1+2];if(p1&&p1.hasOwnProperty("_iValueIndex")&&p1._iValueIndex===0){if(p1 instanceof e&&!p1._bParseError){p1.setValueState(V.None);p1.setValueStateText();}q1=o1.getContent()[l1+3];if(q1&&q1.hasOwnProperty("_iValueIndex")&&q1._iValueIndex===1){if(q1 instanceof e&&!q1._bParseError){q1.setValueState(V.None);q1.setValueStateText();}}else{q1=undefined;}}else{p1=undefined;}if(m1.createControl||n1.createControl){if(p1){p1.destroy();}if(q1){q1.destroy();}}else{if(p1&&m1.valueTypes[0]!==n1.valueTypes[0]){p1.unbindProperty("value");}if(q1&&m1.valueTypes[1]!==n1.valueTypes[1]&&n1.valueTypes[1]){q1.unbindProperty("value");}}}if(!j1){var r1=n.getBindingContext("$this").getObject();if(r1){var s1=this.getConditions();l1=F.indexOfCondition(r1,s1);if(l1>=0){r1=s1[l1];r1.operator=k1;this.setProperty("conditions",s1,true);}}}var t1=this.oOperatorModel.getData();var u1;for(var i=0;i<t1.length;i++){var v1=t1[i];if(v1.key===j1){u1=v1.text;break;}}n.setAdditionalValue(u1);this.onChange();}function t(i,n,j1,k1){var l1=F.getOperator(i.operator);if(!l1||!l1.valueTypes[n]){return null;}var m1=u.call(this,l1.name,n);var n1=this._oManagedObjectModel.getContext(k1.getPath()+"values/"+n+"/");var o1;if(l1.createControl){o1=l1.createControl(m1,"$this>",n,j1);}else{o1=new e(j1,{delegate:N.call(this),value:{path:"$this>",type:m1,mode:'TwoWay',targetType:'raw'},editMode:{path:"$condition>operator",formatter:$},width:"100%"});}if(o1.getMetadata().hasProperty("placeholder")){if(n===0){o1.bindProperty("placeholder",{path:"$condition>operator",formatter:d1});}else{o1.bindProperty("placeholder",{path:"$condition>operator",formatter:e1});}}o1._iValueIndex=n;if(o1.attachChange){o1.attachChange(this.onChange.bind(this));}o1.onpaste=this.onPaste.bind(this);o1.setLayoutData(new k({span:{path:"$condition>",formatter:c1.bind(this)}}));o1.setBindingContext(n1,"$this");o1.setBindingContext(k1,"$condition");o1.setFieldGroupIds([k1.getPath()]);return o1;}function u(i,n){var j1=A.call(this);var k1=F.getOperator(i);if(k1.valueTypes[n]&&[O.ValueType.Self,O.ValueType.Static].indexOf(k1.valueTypes[n])===-1){j1=k1._createLocalType(k1.valueTypes[n],j1);}var l1=false;if(k1.valueTypes[n]===O.ValueType.Static){l1=true;j1=H.call(this);}var m1=l1?B.String:K.call(this,j1);var n1;switch(m1){case B.Numeric:var o1=j1.getFormatOptions();if(o1&&o1.hasOwnProperty("emptyString")&&o1.emptyString===null){n1=j1;}else{n1=v(j1,{emptyString:null});}break;case B.Date:case B.Time:case B.DateTime:n1=j1;break;default:if(j1.getConstraints()&&j1.getConstraints().hasOwnProperty("nullable")&&j1.getConstraints().nullable===false){n1=v(j1);}else{n1=j1;}break;}return n1;}function v(i,n,j1){var k1=sap.ui.require(i.getMetadata().getName().replace(/\./g,"/"));var l1=m(i.getFormatOptions(),n||{});var m1=m(i.getConstraints(),j1||{});if(m1.hasOwnProperty("nullable")&&m1.nullable===false){m1.nullable=true;}return new k1(l1,m1);}function w(){var n=x.call(this);var j1;var k1=this.getFormatOptions().defaultOperatorName;if(k1){j1=F.getOperator(k1);}else{var l1=A.call(this);var m1=K.call(this,l1);j1=F.getDefaultOperator(m1);}if(j1&&n.indexOf(j1.name)<0){for(var i=0;i<n.length;i++){j1=F.getOperator(n[i]);if(j1.exclude||!j1.hasRequiredValues()){j1=undefined;}else{break;}}}if(!j1){j1=F.getOperator(n[0]);}return j1;}function x(){var i=this.getFormatOptions();var n=i&&i.operators;if(!n||n.length===0){n=F.getOperatorsForType(B.String);}return n;}function y(){var n;var j1=x.call(this);for(var i=0;i<j1.length;i++){var k1=j1[i];var l1=F.getOperator(k1);if(!n){n=l1.group.id;}else if(n!==l1.group.id){return true;}}return false;}function z(){if(!this.oOperatorModel){return;}var n=A.call(this);var j1=x.call(this);var k1=[];var l1=y.call(this);var m1=this.getId()+"--rowSelect-help";var n1=sap.ui.getCore().byId(m1);var o1;if(l1){o1=new f({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}",groupKey:"{om>groupId}",groupText:"{om>groupText}"});}else{o1=new j({key:"{om>key}",text:"{om>text}",additionalText:"{om>additionalText}"});}n1.bindAggregation("items",{path:'om>/',templateShareable:false,template:o1});for(var i=0;i<j1.length;i++){var p1=j1[i];var q1=F.getOperator(p1);if(!q1||(q1.showInSuggest!==undefined&&q1.showInSuggest==false)){continue;}var r1=q1.textKey||"operators."+q1.name+".longText";var s1=q1.getTypeText(r1,K.call(this,n).toLowerCase());if(s1===r1){s1=q1.longText;}var t1=q1.additionalInfo;if(t1===undefined){if(t1!==""&&q1.formatRange){t1=q1.formatRange(q1._getRange(undefined,n),n);}else if(!l1){t1=q1.group.text;}}k1.push({key:q1.name,text:s1,additionalText:t1,groupId:q1.group.id,groupText:q1.group.text});}this.oOperatorModel.setData(k1);}function A(){var i=this.getFormatOptions();var n=i&&i.valueType;if(!n){n=H.call(this);}return n;}function H(){if(!this._oDefaultType){this._oDefaultType=new S();}return this._oDefaultType;}function K(i){var n=i.getMetadata().getName();var j1=i.getFormatOptions();var k1=i.getConstraints();var l1=this.getFormatOptions().delegate;var m1=this.getFormatOptions().payload;var n1=l1?l1.getTypeUtil(m1).getBaseType(n,j1,k1):B.String;if(n1===B.Unit){n1=B.Numeric;}return n1;}function N(){var i=this.getFormatOptions();var n=i.delegateName||"sap/ui/mdc/field/FieldBaseDelegate";var j1=i.payload;return{name:n,payload:j1};}function Q(n,j1,k1){var l1=A.call(this);var m1=[];var i=0;for(i=0;i<n.length;i++){var n1=n[i];var o1=F.getOperator(n1.operator);if(o1&&o1.valueTypes[0]===O.ValueType.Static&&(n1.values.length===0||k1)){if(o1.getStaticText){var p1=o1.getStaticText(l1);if(n1.values.length>0){n1.values[0]=p1;}else{n1.values.push(p1);}m1.push(i);}}}if(m1.length>0){this.setProperty("conditions",n,true);}}function T(){var i=new I(this.getId()+"--ivtOperator",{text:"{$i18n>valuehelp.DEFINECONDITIONS_OPERATORLABEL}"});var n=new P({headerText:"{$this>/label}",expanded:true,height:"100%",backgroundDesign:"Transparent"}).addStyleClass("sapMdcDefineconditionPanel");n.addDependent(new L(this.getId()+"--rowSelect-help",{filterList:false,useFirstMatch:true}));var j1=new G(this.getId()+"--conditions",{width:"100%",hSpacing:0,vSpacing:0,containerQuery:true}).addStyleClass("sapUiMdcDefineConditionGrid");Z.call(this,undefined,j1,0,null,0);n.addContent(i);n.addContent(j1);var k1=new p(this.getId()+"--addBtn",{press:this.addCondition.bind(this),type:r.Default,text:"{$i18n>valuehelp.DEFINECONDITIONS_ADDCONDITION}",layoutData:new k({span:"XL2 L3 M3 S3",indent:"XL9 L8 M8 S7",linebreak:true,visibleS:{path:"$this>/conditions",formatter:U.bind(this)},visibleM:{path:"$this>/conditions",formatter:U.bind(this)},visibleL:{path:"$this>/conditions",formatter:U.bind(this)},visibleXL:{path:"$this>/conditions",formatter:U.bind(this)}})});j1.addContent(k1);j1.attachValidateFieldGroup(g1,this);this.setAggregation("_content",n);}function U(i){var n=this.getFormatOptions();var j1=n.hasOwnProperty("maxConditions")?n.maxConditions:-1;return j1===-1||i.length<j1;}function W(i){var n=this.getFormatOptions();var j1=n.hasOwnProperty("maxConditions")?n.maxConditions:-1;return j1!==1;}function X(){var n=this.getConditions();var j1=this.byId("conditions");var k1;var l1=-1;var m1=0;for(var i=0;i<n.length;i++){var n1=n[i];var o1=F.getOperator(n1.operator);if(n1.validated!==c.Validated||o1.exclude){var p1=this._oManagedObjectModel.getContext("/conditions/"+i+"/");l1++;if(!this.oOperatorModel){this.oOperatorModel=new J();this.setModel(this.oOperatorModel,"om");z.call(this);}k1=j1.getContent();if(k1[m1]&&k1[m1].isA("sap.ui.mdc.Field")){m1=f1.call(this,n1,j1,m1,p1,l1);}else{m1=Z.call(this,n1,j1,m1,p1,l1);}}}k1=j1.getContent();while(k1[m1]&&k1[m1]!==this.byId("addBtn")){k1[m1].destroy();m1++;}if(this._bFocusLastCondition){k1[0].focus();this._bFocusLastCondition=false;}if(this._bFocusLastRemoveBtn){m1=Y.call(this,["-removeBtnLarge","-removeBtnSmall"]);k1[m1].focus();this._bFocusLastRemoveBtn=false;}}function Y(j1){var k1=this.byId("conditions");var l1=k1.getContent();var n=l1.length-1;if(!Array.isArray(j1)){j1=[j1];}var i=0;var m1=j1[i];while(n>=0&&m1!==undefined){var n1=l1[n];if(n1.getId().endsWith(m1)){var o1=jQuery(n1.getDomRef());if(o1.is(":visible")){return n;}else{i++;m1=j1[i];}}n--;}return 0;}function Z(n,j1,k1,l1,m1){var n1=this.getId()+"--"+m1;if(!this._oOperatorFieldType){this._oOperatorFieldType=new S({},{minLength:1});}var o1=new e(n1+"-operator",{value:{path:"$this>operator",type:this._oOperatorFieldType},width:"100%",display:"Description",fieldHelp:this.getId()+"--rowSelect-help",change:this.onSelectChange.bind(this),ariaLabelledBy:this.getId()+"--ivtOperator"}).setLayoutData(new k({span:{path:"$this>/conditions",formatter:b1.bind(this)},linebreak:true})).setBindingContext(l1,"$this");if(l1){o1.setFieldGroupIds([l1.getPath()]);}this._oObserver.observe(o1,{properties:["value"]});j1.insertContent(o1,k1);k1++;var p1=new p(n1+"--removeBtnSmall",{press:this.removeCondition.bind(this),type:r.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new k({span:"XL1 L1 M1 S2",indent:{path:"$this>operator",formatter:a1},visibleS:{path:"$this>/conditions",formatter:W.bind(this)},visibleM:false,visibleL:false,visibleXL:false})).setBindingContext(l1,"$this");if(l1){p1.setFieldGroupIds([l1.getPath()]);}j1.insertContent(p1,k1);k1++;if(n){for(var i=0;i<n.values.length;i++){var q1=t.call(this,n,i,n1+"-values"+i,l1);if(q1){j1.insertContent(q1,k1);k1++;}}}var r1=new p(n1+"--removeBtnLarge",{press:this.removeCondition.bind(this),type:r.Transparent,icon:"sap-icon://decline",tooltip:"{$i18n>valuehelp.DEFINECONDITIONS_REMOVECONDITION}"}).setLayoutData(new k({span:"XL1 L1 M1 S1",indent:{path:"$this>operator",formatter:a1},visibleS:false,visibleM:{path:"$this>/conditions",formatter:W.bind(this)},visibleL:{path:"$this>/conditions",formatter:W.bind(this)},visibleXL:{path:"$this>/conditions",formatter:W.bind(this)}})).setBindingContext(l1,"$this");j1.insertContent(r1,k1);k1++;return k1;}function $(i){if(!i){return E.Display;}var n=F.getOperator(i);var j1=false;if(n&&n.valueTypes[0]===O.ValueType.Static){j1=true;}return j1?E.Display:E.Editable;}function a1(i){var n=i&&F.getOperator(i);if(!n||!n.valueTypes[0]){return"XL8 L8 M8 S0";}else{return"";}}function b1(i){var n=this.getFormatOptions();var j1=n.hasOwnProperty("maxConditions")?n.maxConditions:-1;var k1="XL3 L3 M3 ";if(j1===1){k1+="S12";}else{k1+="S10";}return k1;}function c1(i){var n=this.getFormatOptions();var j1=n.hasOwnProperty("maxConditions")?n.maxConditions:-1;var k1=i&&F.getOperator(i.operator);var l1="";if(k1&&k1.valueTypes[1]){l1="XL4 L4 M4 ";}else{l1="XL8 L8 M8 ";}if(j1===1){l1+="S12";}else{l1+="S10";}return l1;}function d1(i){var n=i&&F.getOperator(i);if(n&&n.aLabels){return n.aLabels[0];}else if(n&&n.valueTypes[1]){return q.getText("valuehelp.DEFINECONDITIONS_FROM");}else{return q.getText("valuehelp.DEFINECONDITIONS_VALUE");}}function e1(i){var n=i&&F.getOperator(i);if(n&&n.aLabels){return n.aLabels[1];}else if(n&&n.valueTypes[1]){return q.getText("valuehelp.DEFINECONDITIONS_TO");}}function f1(n,j1,k1,l1,m1){var n1=this.getId()+"--"+m1;var o1=j1.getContent();var p1;var q1=o1[k1];q1.setBindingContext(l1,"$this");if(l1){q1.setFieldGroupIds([l1.getPath()]);}k1++;var r1=o1[k1];r1.setBindingContext(l1,"$this");if(l1){r1.setFieldGroupIds([l1.getPath()]);}k1++;var s1;var t1=o1[k1];var u1;if(t1.hasOwnProperty("_iValueIndex")&&t1._iValueIndex===0){var v1=$(n.operator);if(n.values.length>0||v1===E.Display){s1=this._oManagedObjectModel.getContext(l1.getPath()+"values/0/");t1.setBindingContext(s1,"$this");t1.setBindingContext(l1,"$condition");if(t1.getMetadata().hasProperty("value")&&(this._bUpdateType||!t1.getBindingInfo("value"))){p1=u.call(this,n.operator,0);t1.bindProperty("value",{path:"$this>",type:p1});}k1++;u1=o1[k1];if(u1.hasOwnProperty("_iValueIndex")&&u1._iValueIndex===1){if(n.values.length>1){s1=this._oManagedObjectModel.getContext(l1.getPath()+"values/1/");u1.setBindingContext(s1,"$this");if(u1.getMetadata().hasProperty("value")&&(this._bUpdateType||!u1.getBindingInfo("value"))){p1=u.call(this,n.operator,1);u1.bindProperty("value",{path:"$this>",type:p1});}k1++;}else{u1.destroy();}}else if(n.values.length>1){u1=t.call(this,n,1,n1+"-values1",l1);if(u1){j1.insertContent(u1,k1);k1++;}}}else{t1.destroy();t1=undefined;u1=o1[k1+1];if(u1&&u1.hasOwnProperty("_iValueIndex")&&u1._iValueIndex===1){u1.destroy();}}}else if(n.values.length>0){for(var i=0;i<n.values.length;i++){var w1=t.call(this,n,i,n1+"-values"+i,l1);if(w1){j1.insertContent(w1,k1);k1++;}}}o1=j1.getContent();var x1=o1[k1];x1.setBindingContext(l1,"$this");k1++;return k1;}function g1(i){var n=i.getSource();while(!(n.getParent()instanceof G)){n=n.getParent();}h1.call(this,n);}function h1(i){var n=i.getParent();var j1=n.indexOfContent(i);var k1;if(i.getId().endsWith("-operator")){k1=i.getBindingContext("$this");j1=j1+2;i=n.getContent()[j1];}else if(i.getId().endsWith("-removeBtnSmall")){k1=i.getBindingContext("$this");j1=j1+1;i=n.getContent()[j1];}else{k1=i.getBindingContext("$condition");}var l1;var m1=k1.getObject();var n1=F.getOperator(m1.operator);var o1=false;if(n1.valueTypes.length>0&&n1.valueTypes[0]!==O.ValueType.Static){if(n1.valueTypes.length>1&&n1.valueTypes[1]){if(i.hasOwnProperty("_iValueIndex")&&i._iValueIndex===0){l1=n.getContent()[j1+1];}else if(i.hasOwnProperty("_iValueIndex")&&i._iValueIndex===1){l1=n.getContent()[j1-1];}}if(i.getMetadata().getAllProperties().valueState&&!i._bParseError&&(!l1||!l1._bParseError)){var p1=i.getBinding("value").getType();try{n1.validate(m1.values,p1);i.setValueState(V.None);i.setValueStateText();if(l1&&l1.getMetadata().getAllProperties().valueState){l1.setValueState(V.None);l1.setValueStateText();}}catch(q1){o1=true;i.setValueState(V.Error);i.setValueStateText(q1.message);if(l1&&l1.getMetadata().getAllProperties().valueState){l1.setValueState(V.Error);l1.setValueStateText(q1.message);}}}}i1.call(this,o1);}function i1(n){if(n!==true){var j1=this.byId("conditions");var k1=j1.getContent();n=false;for(var i=0;i<k1.length;i++){var l1=k1[i];if(l1 instanceof e&&l1.hasOwnProperty("_iValueIndex")&&l1.getValueState()===V.Error){n=true;break;}}}this.setProperty("inputOK",!n,true);}return D;});
