/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/mdc/p13n/subcontroller/FilterController','sap/ui/core/library','sap/ui/mdc/p13n/FlexUtil','sap/ui/Device','sap/ui/mdc/Control','sap/base/util/merge','sap/base/util/deepEqual','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/base/Log','sap/ui/mdc/condition/ConditionModel','sap/ui/mdc/condition/Condition','sap/ui/mdc/util/IdentifierUtil','sap/ui/mdc/condition/ConditionConverter','sap/m/MessageBox',"sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/ui/mdc/p13n/StateUtil","sap/ui/mdc/condition/FilterConverter","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/mdc/util/FilterUtil","sap/m/Button","sap/m/library","sap/ui/core/ShortcutHintsMixin"],function(F,c,a,D,C,m,d,M,b,L,e,f,I,g,h,j,S,k,l,n,B,o,p){"use strict";var V=c.ValueState;var q=C.extend("sap.ui.mdc.filterbar.FilterBarBase",{metadata:{library:"sap.ui.mdc",defaultAggregation:"filterItems",interfaces:["sap.ui.mdc.IFilter","sap.ui.mdc.IxState"],properties:{delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/FilterBarDelegate",payload:{modelName:undefined,collectionName:""}}},liveMode:{type:"boolean",defaultValue:false},showMessages:{type:"boolean",group:"Misc",defaultValue:true},showGoButton:{type:"boolean",defaultValue:true},filterConditions:{type:"object",defaultValue:{}},suspendSelection:{type:"boolean",defaultValue:false},_filterCount:{type:"string",visibility:"hidden"}},aggregations:{filterItems:{type:"sap.ui.mdc.FilterField",multiple:true},basicSearchField:{type:"sap.ui.mdc.FilterField",multiple:false},layout:{type:"sap.ui.mdc.filterbar.IFilterContainer",multiple:false,visibility:"hidden"}},associations:{variantBackreference:{type:"sap.ui.fl.variants.VariantManagement",multiple:false}},events:{search:{conditions:{type:"object"}},filtersChanged:{conditionsBased:{type:"boolean"},filtersText:{type:"string"},filtersTextExpanded:{type:"string"}}}}});var r=o.ButtonType;q.INNER_MODEL_NAME="$sap.ui.filterbar.mdc.FilterBarBase";q.CONDITION_MODEL_NAME="$filters";var E={NoError:-1,RequiredHasNoValue:0,FieldInErrorState:1,AsyncValidation:2};q.prototype.init=function(){C.prototype.init.apply(this,arguments);this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._createInnerModel();this._oObserver=new b(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["filterItems","basicSearchField"]});this._createInnerLayout();this._bPersistValues=false;this._aProperties=null;this._fResolveInitialFiltersApplied=undefined;this._oInitialFiltersAppliedPromise=new Promise(function(i){this._fResolveInitialFiltersApplied=i;}.bind(this));this._bIgnoreChanges=false;this._bSearchTriggered=false;this._bIgnoreQueuing=false;};q.prototype._createInnerLayout=function(){this._cLayoutItem=null;this._oFilterBarLayout=null;this._bPersistValues=false;this._btnAdapt=null;this.setAggregation("layout",this._oFilterBarLayout,true);};q.prototype._isPhone=function(){return(D.system.phone)?true:false;};q.prototype._isLiveMode=function(){if(this._isPhone()){return false;}return this.getLiveMode();};q.prototype._getConditionModel=function(){return this._oConditionModel;};q.prototype._getSearchButton=function(){if(!this._btnSearch){this._btnSearch=new B(this.getId()+"-btnSearch",{text:this._oRb.getText("filterbar.GO"),press:this.onSearch.bind(this),type:r.Emphasized});p.addConfig(this._btnSearch,{addAccessibilityLabel:true,message:this._oRb.getText("filterbar.GoBtnShortCutHint")},this);}return this._btnSearch;};q.prototype.getConditionModelName=function(){return this._getConditionModelName();};q.prototype._getConditionModelName=function(){return q.CONDITION_MODEL_NAME;};q.prototype._createConditionModel=function(){this._oConditionModel=new e();this.setModel(this._oConditionModel,this._getConditionModelName());};q.prototype.applySettings=function(s,i){C.prototype.applySettings.apply(this,arguments);this._createConditionModel();this._oConditionModel.attachPropertyChange(this._handleConditionModelPropertyChange,this);this._retrieveMetadata().then(function(){this._applyInitialFilterConditions();}.bind(this));};q.prototype.setIgnoreQueuing=function(v){this._bIgnoreQueuing=v;};q.prototype.getIgnoreQueuing=function(){return this._bIgnoreQueuing;};q.prototype.setSuspendSelection=function(v){this.setProperty("suspendSelection",v);if(!v){if(this._bSearchTriggered&&!this.getIgnoreQueuing()){this.triggerSearch();}this._bSearchTriggered=false;this.setIgnoreQueuing(false);}return this;};q.prototype._createInnerModel=function(){this._oModel=new M(this);this.setModel(this._oModel,q.INNER_MODEL_NAME);return this;};q.prototype.getCurrentState=function(){var s={};if(this._bPersistValues){var i=[];var t=m({},this.getFilterConditions());for(var K in t){if(!this._getPropertyByName(K)){i.push(K);}}i.forEach(function(K){delete t[K];});s.filter=t;}var u=this.getFilterItems();var v=[];u.forEach(function(w,x){v.push({name:w.getFieldPath()});});s.items=v;return s;};q.prototype.getAssignedFilterNames=function(){var N,i=null,s=this._getConditionModel();if(s){i=[];var t=s.getConditions("$search");if(t&&t.length>0){i.push(this._oRb.getText("filterbar.ADAPT_SEARCHTERM"));}this._getNonHiddenPropertyInfoSet().forEach(function(P){N=I.getPropertyKey(P);var t=s.getConditions(N);if(t&&t.length>0){i.push(P.label||N);}});}return i;};q.prototype._getAssignedFiltersText=function(){var t={};t.filtersText=this._getAssignedFiltersCollapsedText(this.getAssignedFilterNames());t.filtersTextExpanded=this._getAssignedFiltersExpandedText();return t;};q.prototype._getAssignedFiltersExpandedText=function(){var i=0,s=0,t=this._getConditionModel();if(t){var A=t.getAllConditions();for(var u in A){var P=this._getPropertyByName(u);if(P&&!P.hiddenFilter&&(A[u].length>0)){++i;if(!(((u==="$search")&&this.getAggregation("basicSearchField"))||this._getFilterField(u))){++s;}}}}if(!i&&!s){return this._oRb.getText("filterbar.ADAPT_NOTFILTERED");}if(!s){if(i===1){return this._oRb.getText("filterbar.ADAPT_FILTER_WITH_NON_HIDDEN",[i]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_WITH_NON_HIDDEN",[i]);}if((i===1)){return this._oRb.getText("filterbar.ADAPT_FILTER_WITH_HIDDEN",[i,s]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_WITH_HIDDEN",[i,s]);};q.prototype._getAssignedFiltersCollapsedText=function(s){var A;s=s||[];if(s.length){A=Object.keys(s).map(function(i){return s[i];}).join(", ");if(s.length===1){return this._oRb.getText("filterbar.ADAPT_FILTER_COLLAPSED",[s.length,A]);}return this._oRb.getText("filterbar.ADAPT_FILTERS_COLLAPSED",[s.length,A]);}return this._oRb.getText("filterbar.ADAPT_NOTFILTERED");};q.prototype.getAssignedFiltersText=function(){return this._getAssignedFiltersText();};q.prototype._reportModelChange=function(t,i){this._handleAssignedFilterNames(false,i);if(this.getLiveMode()||t){this.triggerSearch();}};q.prototype._isPersistenceSupported=function(i){return this.getEngine().isModificationSupported(this);};q.prototype._handleConditionModelPropertyChange=function(i){if(!this._bIgnoreChanges){var P=i.getParameter("path");if(P.indexOf("/conditions/")===0){var s=P.substring("/conditions/".length);if(this._bPersistValues&&this._isPersistenceSupported()){var O={};O[s]=this._stringifyConditions(s,i.getParameter("value"));this._cleanupConditions(O[s]);this.getEngine().createChanges({control:this,key:"Filter",state:O});}else{this._reportModelChange(false);}}}};q.prototype._toExternal=function(P,i){var s=m({},i);s=g.toString(s,P.typeConfig,this.getTypeUtil());this._cleanupCondition(s);this._convertInOutParameters(i,s,"inParameters",g.toString);this._convertInOutParameters(i,s,"outParameters",g.toString);return s;};q.prototype._toInternal=function(P,i){var s=m({},i);s=g.toType(s,P.typeConfig,this.getTypeUtil());this._convertInOutParameters(i,s,"inParameters",g.toType);this._convertInOutParameters(i,s,"outParameters",g.toType);return s;};q.prototype._convertInOutParameters=function(i,s,P,t){if(i[P]&&(Object.keys(i[P]).length>0)){Object.keys(i[P]).forEach(function(K){var N=K.startsWith("conditions/")?K.slice(11):K;var u=this._getPropertyByName(N);if(u){var O=f.createCondition("EQ",[i[P][K]]);var v=t(O,u.typeConfig,this.getTypeUtil());if(!s[P]){s[P]={};}if(!K.startsWith("conditions/")){delete s[P][K];K="conditions/"+N;}s[P][K]=v.values[0];}else{L.error("mdc.FilterBar._convertInOutParameters: could not find property info for "+N);}}.bind(this));}};q.prototype._cleanupCondition=function(i){if(i){if(i.hasOwnProperty("isEmpty")){delete i.isEmpty;}}};q.prototype._cleanupConditions=function(i){if(i){i.forEach(function(s){this._cleanupCondition(s);},this);}};q.prototype._stringifyCondition=function(P,i){var R=i;if(i&&i.values){if(i.values.length>0){R=this._toExternal(P,i);}else{R=m({},i);this._cleanupCondition(R);}}return R;};q.prototype._stringifyConditions=function(s,i){var P=this._getPropertyByName(s);var R=i;if(P&&i){R=[];i.forEach(function(t){R.push(this._stringifyCondition(P,t));},this);}return R;};q.prototype._handleAssignedFilterNames=function(i,s){if(!this._oMetadataAppliedPromise){return;}this._oMetadataAppliedPromise.then(function(){if(this._bIsBeingDestroyed){return;}if(!i){if(this._btnAdapt){var t=this.getAssignedFilterNames();this.setProperty("_filterCount",this._oRb.getText(t.length?"filterbar.ADAPT_NONZERO":"filterbar.ADAPT",t.length),false);}}var T=this._getAssignedFiltersText();var O={conditionsBased:(!i&&!s),filtersText:T.filtersText,filtersTextExpanded:T.filtersTextExpanded};this.fireFiltersChanged(O);}.bind(this));};q.prototype.onReset=function(i){this._getConditionModel().oConditionModel.removeAllConditions();};q.prototype.onSearch=function(i){this.triggerSearch();};q.prototype.triggerSearch=function(){return this.valid(true);};q.prototype.valid=function(i){i=typeof i=="boolean"?i:true;if(this.getSuspendSelection()&&i){this._bSearchTriggered=true;return Promise.resolve();}return this.initialized().then(function(){if(!this._oSearchPromise){this._oSearchPromise=new Promise(function(t,u){this._fResolvedSearchPromise=t;this._fRejectedSearchPromise=u;}.bind(this));var s=function(){this._validate(i);this._oSearchPromise=null;};setTimeout(s.bind(this),0);}return this._oSearchPromise;}.bind(this));};q.prototype._clearDelayedSearch=function(){if(this._iDelayedSearchId){clearTimeout(this._iDelayedSearchId);this._iDelayedSearchId=null;}};q.prototype._getRequiredFieldsWithoutValues=function(){var R=[];this._getRequiredPropertyNames().forEach(function(N){var i=this._getConditionModel().getConditions(N);if(!i||i.length===0){R.push(N);}}.bind(this));return R;};q.prototype._checkAsyncValidation=function(){var R=E.NoError;if(this._aFIChanges&&this._aFIChanges.length>0){R=E.AsyncValidation;}return R;};q.prototype._checkRequiredFields=function(){var R=E.NoError;var i=this._getRequiredFieldsWithoutValues();i.forEach(function(N){var s=this._getFilterField(N);if(s){if(s.getValueState()===V.None){s.setValueState(V.Error);s.setValueStateText(this._oRb.getText("filterbar.REQUIRED_FILTER_VALUE_MISSING"));}}else{L.error("Mandatory filter field '"+N+"' not visible on FilterBarBase has no value.");}R=E.RequiredHasNoValue;}.bind(this));return R;};q.prototype._checkFieldsInErrorState=function(){var R=E.NoError;this._getNonRequiredPropertyNames().some(function(N){var i=this._getFilterField(N);if(i&&(i.getValueState()!==V.None)){R=E.FieldInErrorState;}return R!==E.NoError;}.bind(this));return R;};q.prototype._handleFilterItemSubmit=function(i){var P=i.getParameter("promise");if(P){P.then(function(){this.triggerSearch();}.bind(this));}};q.prototype._handleFilterItemChanges=function(i){if(this._bIgnoreChanges){return;}var s=i.oSource;if(s.getRequired()&&(s.getValueState()===V.Error)&&i.getParameter("valid")){s.setValueState(V.None);return;}if(!this._aFIChanges){this._aFIChanges=[];}this._aFIChanges.push({name:s.getFieldPath(),promise:i.getParameter("promise")});};q.prototype._checkFilters=function(){var R=this._checkAsyncValidation();if(R!==E.NoError){return R;}R=this._checkRequiredFields();if(R!==E.NoError){return R;}R=this._checkFieldsInErrorState();if(R!==E.NoError){return R;}return R;};q.prototype._setFocusOnFirstErroneousField=function(){this.getFilterItems().some(function(i){if(i.getValueState()!==V.None){setTimeout(i["focus"].bind(i),0);return true;}return false;});};q.prototype._handleAsyncValidation=function(i){if(this._aFIChanges&&(this._aFIChanges.length>0)){var N=this._aFIChanges.slice();this._aFIChanges=null;var s=[];N.forEach(function(t){s.push(t.promise);});Promise.all(s).then(function(t){t.forEach(function(u,v){var w=this._getFilterField(N[v].name);if(w&&w.getRequired()&&(w.getValueState()===V.Error)){w.setValueState(V.None);}},this);this._validate(i);}.bind(this),function(t){this._validate(i);}.bind(this));}};q.prototype._validate=function(i){var s,R;R=this._checkFilters();if(R===E.AsyncValidation){this._handleAsyncValidation(i);return;}var t=function(){this._fRejectedSearchPromise=null;this._fResolvedSearchPromise=null;}.bind(this);if(R===E.NoError){if(i){this.fireSearch();}this._fResolvedSearchPromise();t();}else{if(R===E.RequiredHasNoValue){s=this._oRb.getText("filterbar.REQUIRED_CONDITION_MISSING");}else{s=this._oRb.getText("filterbar.VALIDATION_ERROR");}if(this.getShowMessages()&&!this._isLiveMode()){try{h.error(s,{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":"",onClose:this._setFocusOnFirstErroneousField.bind(this)});}catch(x){L.error(x.message);}}else{L.warning("search was not triggered. "+s);}this._fRejectedSearchPromise();t();}};q.prototype.setInternalConditions=function(i){var s=this._getConditionModel();if(s){s.setConditions(i);}};q.prototype.getInternalConditions=function(){return this._getModelConditions(this._getConditionModel(),true);};q.prototype.hasProperty=function(N){return this._getPropertyByName(N);};q.prototype.waitForInitialization=function(){return Promise.all([this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise]);};q.prototype.initialized=function(){return this.waitForInitialization();};q.prototype._getModelConditions=function(i,s,K){var t={};if(i){var A=i.getAllConditions();for(var u in A){if(A[u]&&(K||A[u].length>0)){t[u]=m([],A[u]);if(!s){this._cleanupConditions(t[u]);var v=this._stringifyConditions(u,t[u]);t[u]=v;}}}}return t;};var _=function(P){var t=P.typeConfig.typeInstance;var i=t.getConstraints();return t.getMetadata().getName()==="sap.ui.model.odata.type.String"&&i&&i.isDigitSequence&&i.maxLength?function(s){return this._toExternal(P,s,this.getTypeUtil());}.bind(this):undefined;};q.prototype.removeCondition=function(s,x){return this.initialized().then(function(){var i=this._getConditionModel();if(i){var P=this._getPropertyByName(s);if(P){var t=this._toInternal(P,x);if(i.indexOf(s,t,_.call(this,P))>=0){i.removeCondition(s,t);}}}}.bind(this));};q.prototype.addCondition=function(s,x){return this.initialized().then(function(){var i=this._getConditionModel();if(i){var P=this._getPropertyByName(s);if(P){var t=this._toInternal(P,x);if(i.indexOf(s,t,_.call(this,P))<0){var u=[{sFieldPath:P}];F.checkConditionOperatorSanity(u);if(u&&u.length>0){this._cleanUpFilterFieldInErrorStateByName(s);i.addCondition(s,t);}}}}}.bind(this));};q.prototype._setXConditions=function(i,R){var P,s,t=this._getConditionModel();if(R){t.removeAllConditions();}if(i){for(var u in i){s=i[u];P=this._getPropertyByName(u);if(P){if(s.length===0){t.removeAllConditions(u);}else{s.forEach(function(v){if(P.maxConditions!==-1){t.removeAllConditions(u);}var N=this._toInternal(P,v);t.addCondition(u,N);}.bind(this));}}}}};q.prototype._getXConditions=function(){return this._getModelConditions(this._getConditionModel(),false);};q.prototype._getRequiredPropertyNames=function(){var R=[];this._getNonHiddenPropertyInfoSet().forEach(function(P){if(P.required){R.push(I.getPropertyKey(P));}});return R;};q.prototype._getNonRequiredPropertyNames=function(){var N=[];this._getNonHiddenPropertyInfoSet().forEach(function(P){if(!P.required){N.push(I.getPropertyKey(P));}});return N;};q.prototype._insertFilterFieldtoContent=function(i,s){if(!this._cLayoutItem){return;}var t=this._cLayoutItem;var u=new t();u.setFilterField(i);this._oFilterBarLayout.insertFilterField(u,s);};q.prototype._filterItemInserted=function(i){if(!i.getVisible()){return;}if(i.setWidth){i.setWidth("");}this._applyFilterItemInserted(i);this._handleAssignedFilterNames(true);};q.prototype._applyFilterItemInserted=function(s){var t,u;u=this.indexOfAggregation("filterItems",s);if(this.getAggregation("basicSearchField")){u++;}t=u;var v=this.getFilterItems();for(var i=0;i<t;i++){if(!v[i].getVisible()){u--;}}this._insertFilterFieldtoContent(s,u);if(!this._oObserver.isObserved(s,{properties:["visible"]})){this._oObserver.observe(s,{properties:["visible"]});}};q.prototype._filterItemRemoved=function(i){this._applyFilterItemRemoved(i.getFieldPath());this._handleAssignedFilterNames(true);};q.prototype._applyFilterItemRemoved=function(s){this._removeFilterFieldFromContentByName(s);};q.prototype._removeFilterFieldFromContent=function(i){this._removeFilterFieldFromContentByName(i.getFieldPath());};q.prototype._removeFilterFieldFromContentByName=function(s){var i=this._getFilterItemLayoutByName(s);if(i){this._oFilterBarLayout.removeFilterField(i);i.destroy();}};q.prototype._observeChanges=function(i){if(i.type==="aggregation"){if(i.name==="filterItems"){switch(i.mutation){case"insert":i.child.attachChange(this._handleFilterItemChanges,this);i.child.attachSubmit(this._handleFilterItemSubmit,this);this._filterItemInserted(i.child);break;case"remove":i.child.detachChange(this._handleFilterItemChanges,this);i.child.detachSubmit(this._handleFilterItemSubmit,this);this._filterItemRemoved(i.child);break;default:L.error("operation "+i.mutation+" not yet implemented");}}else if(i.name==="basicSearchField"){switch(i.mutation){case"insert":i.child.attachSubmit(this._handleFilterItemSubmit,this);this._insertFilterFieldtoContent(i.child,0);break;case"remove":i.child.detachSubmit(this._handleFilterItemSubmit,this);this._removeFilterFieldFromContent(i.child);break;default:L.error("operation "+i.mutation+" not yet implemented");}}}else if(i.type==="property"){var s;if(i.object.isA&&i.object.isA("sap.ui.mdc.FilterField")){s=i.object;if(s){if(i.current){this._filterItemInserted(s);}else{this._filterItemRemoved(s);}this._oFilterBarLayout.rerender();}}}};q.prototype._getFilterItemLayout=function(i){return this._getFilterItemLayoutByName(i.getFieldPath());};q.prototype._getFilterItemLayoutByName=function(s){var i=null;if(this._oFilterBarLayout){this._oFilterBarLayout.getFilterFields().some(function(t){if(t._getFieldPath()===s){i=t;}return i!==null;});}return i;};q.prototype._getFilterField=function(N){var i=null;this.getFilterItems().some(function(s){if(s&&s.getFieldPath&&(s.getFieldPath()===N)){i=s;}return i!==null;});return i;};q.prototype._retrieveMetadata=function(){if(this._oMetadataAppliedPromise){return this._oMetadataAppliedPromise;}this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=new Promise(function(i){this._fResolveMetadataApplied=i;}.bind(this));this.initControlDelegate().then(function(){if(!this._bIsBeingDestroyed){this._aProperties=[];var R=function(){this._fResolveMetadataApplied();this._fResolveMetadataApplied=null;}.bind(this);if(this.bDelegateInitialized&&this.getControlDelegate().fetchProperties){try{this.getControlDelegate().fetchProperties(this).then(function(P){this._aProperties=P;R();}.bind(this),function(s){L.error(s);R();});}catch(i){L.error("Exception during fetchProperties occured: "+i.message);R();}}else{L.error("Provided delegate '"+this.getDelegate().path+"' not valid.");R();}}}.bind(this));return this._oMetadataAppliedPromise;};q.prototype.setBasicSearchField=function(i){var O=this.getAggregation("basicSearchField");if(O){this.removeAggregation("basicSearchField",O);}this.setAggregation("basicSearchField",i);if(i){if(!this._oObserver.isObserved(i,{properties:["visible"]})){this._oObserver.observe(i,{properties:["visible"]});}}return this;};q.prototype.getPropertyInfoSet=function(){return this._aProperties||[];};q.prototype._getNonHiddenPropertyInfoSet=function(){var v=[];this.getPropertyInfoSet().every(function(P){if(!P.hiddenFilter){if(I.getPropertyKey(P)!=="$search"){v.push(P);}}return true;});return v;};q.prototype._getNonHiddenPropertyByName=function(N){var P=null;this._getNonHiddenPropertyInfoSet().some(function(i){if(I.getPropertyKey(i)===N){P=i;}return P!=null;});return P;};q.prototype._getPropertyByName=function(N){return n.getPropertyByKey(this.getPropertyInfoSet(),N);};q.prototype._cleanUpFilterFieldInErrorStateByName=function(s){var i=null;var t=this.getFilterItems();t.some(function(u){if(u.getFieldPath()===s){i=u;}return i!=null;});if(i){this._cleanUpFilterFieldInErrorState(i);}};q.prototype._cleanUpAllFilterFieldsInErrorState=function(){var i=this.getFilterItems();i.forEach(function(s){this._cleanUpFilterFieldInErrorState(s);}.bind(this));};q.prototype._cleanUpFilterFieldInErrorState=function(i){if(i.getRequired()&&(i.getValueState()!==V.None)){i.setValueState(V.None);}};q.prototype.applyConditionsAfterChangesApplied=function(){if(this._isChangeApplying()){return;}this._bIgnoreChanges=true;this._oFlexPromise=this._getWaitForChangesPromise();Promise.all([this._oFlexPromise,this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise]).then(function(A){this._oFlexPromise=null;this._changesApplied();}.bind(this));};q.prototype._getWaitForChangesPromise=function(){return this.getEngine().waitForChanges(this);};q.prototype._suspendBinding=function(i){if(i){var s=i.getBinding("conditions");if(s){if(!this._aBindings){this._aBindings=[];}s.suspend();this._aBindings.push(i);}}};q.prototype._resumeBindings=function(){if(this._aBindings){this._aBindings.forEach(function(i){if(!i.bIsDestroyed){var s=i.getBinding("conditions");if(s){s.resume();}}});this._aBindings=null;}};q.prototype._isChangeApplying=function(){return!!this._oFlexPromise;};q.prototype._applyInitialFilterConditions=function(){this._bIgnoreChanges=true;this._applyFilterConditionsChanges();this._changesApplied();this._bInitialFiltersApplied=true;this._fResolveInitialFiltersApplied();this._fResolveInitialFiltersApplied=null;};q.prototype._applyFilterConditionsChanges=function(){var i;var s=this.getProperty("filterConditions");if(Object.keys(s).length>0){i=m([],s);this._setXConditions(i,true,true);}};q.prototype.setVariantBackreference=function(v){if(!this._hasAssignedVariantManagement()){this.setAssociation("variantBackreference",v);l.attachVariantApplied({selector:this,vmControlId:this.getVariantBackreference(),callback:this._handleVariantSwitch.bind(this),callAfterInitialVariant:true});}else{L.error("the association 'variant' may only be assigned once and may not change afterwards.");}};q.prototype._handleVariantSwitch=function(v){this._cleanUpAllFilterFieldsInErrorState();this._bExecuteOnSelect=false;if(v.hasOwnProperty("executeOnSelect")&&v.executeOnSelect){this._bExecuteOnSelect=true;}this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=undefined;if(v.hasOwnProperty("createScenario")&&(v.createScenario==="saveAs")){this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=true;}if(!this._isChangeApplying()&&this._bInitialFiltersApplied){this._changesApplied();}};q.prototype._hasAssignedVariantManagement=function(){var v=this.getVariantBackreference();if(v&&sap.ui.getCore().byId(v)&&sap.ui.getCore().byId(v).isA("sap.ui.fl.variants.VariantManagement")){return true;}return false;};q.prototype._changesApplied=function(){this._bIgnoreChanges=false;this._reportModelChange(this._bExecuteOnSelect,this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch);this._bExecuteOnSelect=undefined;this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=undefined;};q.prototype._getView=function(){return I.getView(this);};q.prototype.getConditions=function(){var i=this._bPersistValues?this.getCurrentState().filter:this._getXConditions();if(i&&i["$search"]){delete i["$search"];}return i;};q.prototype.getSearch=function(){var s=this._getConditionModel()?this._getConditionModel().getConditions("$search"):[];return s[0]?s[0].values[0]:"";};q.prototype.exit=function(){if(this._hasAssignedVariantManagement()){l.detachVariantApplied({selector:this,vmControlId:this.getVariantBackreference()});}if(this.bDelegateInitialized&&this.getControlDelegate().cleanup){this.getControlDelegate().cleanup(this);}C.prototype.exit.apply(this,arguments);this._clearDelayedSearch();this._oFilterBarLayout=null;this._cLayoutItem=null;this._btnAdapt=undefined;this._btnSearch=undefined;this._oRb=null;if(this._oModel){this._oModel.destroy();this._oModel=null;}if(this._oConditionModel){this._oConditionModel.detachPropertyChange(this._handleConditionModelPropertyChange,this);this._oConditionModel.destroy();this._oConditionModel=null;}this._oObserver.disconnect();this._oObserver=undefined;this._bPersistValues=null;this._oDelegate=null;this._aProperties=null;this._oFlexPromise=null;this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=null;this._oInitialFiltersAppliedPromise=null;this._oSearchPromise=null;this._aBindings=null;};return q;});
