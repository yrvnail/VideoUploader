/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Control","./ActionToolbar","./table/TableSettings","./table/GridTableType","./table/ResponsiveTableType","./table/PropertyHelper","./mixin/FilterIntegrationMixin","./library","sap/m/Text","sap/m/Title","sap/m/ColumnHeaderPopover","sap/m/OverflowToolbar","sap/m/library","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/ui/core/dnd/DragDropInfo","sap/ui/core/Item","sap/ui/core/format/ListFormat","sap/ui/events/KeyCodes","sap/ui/model/Sorter","sap/ui/dom/containsOrEquals","sap/base/strings/capitalize","sap/base/util/deepEqual","sap/base/util/Deferred","sap/ui/core/InvisibleMessage","sap/ui/core/InvisibleText","sap/ui/mdc/p13n/subcontroller/ColumnController","sap/ui/mdc/p13n/subcontroller/SortController","sap/ui/mdc/p13n/subcontroller/FilterController","sap/ui/mdc/p13n/subcontroller/GroupController","sap/ui/mdc/p13n/subcontroller/AggregateController","sap/m/ColumnPopoverSelectListItem","sap/m/ColumnPopoverActionItem","sap/base/util/UriParameters"],function(C,A,T,G,R,P,F,l,a,b,c,O,M,d,N,D,I,L,K,S,e,f,g,h,i,j,k,m,n,o,p,q,r,s){"use strict";var t=l.SelectionMode;var u=l.TableType;var v=l.RowAction;var w=M.ToolbarDesign;var x=M.ToolbarStyle;var y="sap.ui.mdc.IFilter";var z=new window.WeakMap();var B=function(_){if(!z.has(_)){z.set(_,{oFilterInfoBar:null});}return z.get(_);};function E(_,a1){sap.ui.require(["sap/m/MessageToast"],function(b1){var c1=d.getLibraryResourceBundle("sap.ui.mdc");b1.show(c1.getText(_,a1));});}var H=C.extend("sap.ui.mdc.Table",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/table/Table.designtime",interfaces:["sap.ui.mdc.IFilterSource","sap.ui.mdc.IxState"],defaultAggregation:"columns",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},rowAction:{type:"sap.ui.mdc.RowAction[]",defaultValue:[]},p13nMode:{type:"sap.ui.mdc.TableP13nMode[]",defaultValue:[]},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/TableDelegate",payload:{}}},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:sap.ui.core.TitleLevel.Auto},autoBindOnInit:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.ui.mdc.SelectionMode",defaultValue:t.None},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},threshold:{type:"int",group:"Appearance",defaultValue:-1},noDataText:{type:"string"},sortConditions:{type:"object"},filterConditions:{type:"object",defaultValue:{}},groupConditions:{type:"object"},aggregateConditions:{type:"object"},enableExport:{type:"boolean",defaultValue:false},busyIndicatorDelay:{type:"int",defaultValue:100},enableColumnResize:{type:"boolean",group:"Behaviour",defaultValue:true}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},type:{type:"sap.ui.mdc.table.TableTypeBase",altTypes:["sap.ui.mdc.TableType"],multiple:false},columns:{type:"sap.ui.mdc.table.Column",multiple:true},creationRow:{type:"sap.ui.mdc.table.CreationRow",multiple:false},actions:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_createToolbar",aggregation:"actions"}},variant:{type:"sap.ui.fl.variants.VariantManagement",multiple:false},quickFilter:{type:"sap.ui.core.Control",multiple:false},rowSettings:{type:"sap.ui.mdc.table.RowSettings",multiple:false},dataStateIndicator:{type:"sap.m.plugins.DataStateIndicator",multiple:false}},associations:{filter:{type:y,multiple:false}},events:{rowPress:{parameters:{bindingContext:{type:"sap.ui.model.Context"}}},selectionChange:{parameters:{bindingContext:{type:"sap.ui.model.Context"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},paste:{parameters:{data:{type:"string[][]"}}}}},constructor:function(){this._oTableReady=new h();this._oFullInitialize=new h();C.apply(this,arguments);this.bCreated=true;this._doOneTimeOperations();this._initializeContent();var _=new s(window.location.search);this._bNewP13n=_.getAll("sap-ui-xx-mdcTableP13n").length>0;},renderer:{apiVersion:2,render:function(_,a1){_.openStart("div",a1);_.class("sapUiMdcTable");_.style("height",a1.getHeight());_.style("width",a1.getWidth());_.openEnd();_.renderControl(a1.getAggregation("_content"));_.close("div");}}});var J=["variant","quickFilter"];F.call(H.prototype);J.forEach(function(_){var a1=f(_),b1="_o"+a1,c1="get"+a1,d1="set"+a1,e1="destroy"+a1;H.prototype[c1]=function(){return this[b1];};H.prototype[e1]=function(){var f1=this[b1];this[d1]();if(f1){f1.destroy();}return this;};H.prototype[d1]=function(f1){this.validateAggregation(_,f1,false);var g1=this._createToolbar(),h1=f1!==this[b1];if(!f1||h1){g1.removeBetween((this[c1]()));this[b1]=f1;}if(h1&&f1){this._setToolbarBetween(g1);}return this;};});H.prototype.init=function(){C.prototype.init.apply(this,arguments);this._bForceRebind=true;this.mSkipPropagation={rowSettings:true};};H.prototype.applySettings=function(){C.prototype.applySettings.apply(this,arguments);this.initControlDelegate();};H.prototype._setToolbarBetween=function(_){[this._oVariant,this._oQuickFilter].forEach(function(a1){if(a1){_.addBetween(a1);}});};H.prototype.initialized=function(){return this._oTableReady.promise;};H.prototype._fullyInitialized=function(){return this._oFullInitialize.promise;};H.prototype.getDataStateIndicatorPluginOwner=function(_){_.setEnableFiltering(false);return this._oTable||this._oFullInitialize.promise;};H.prototype._getStringType=function(_){var a1,b1=a1=_||this.getType();if(!b1){a1=u.Table;}else if(typeof b1==="object"){if(b1.isA("sap.ui.mdc.table.ResponsiveTableType")){a1=u.ResponsiveTable;}else{a1=u.Table;}}return a1;};H.prototype._updateTypeSettings=function(){var _=this.getType();if(_&&typeof _==="object"){_.updateTableSettings();}else{if(_==="ResponsiveTable"){_=R;}else{_=G;}_.updateDefault(this._oTable);}};H.prototype.scrollToIndex=function(_){return new Promise(function(a1,b1){if(!this._oTable){return b1();}if(typeof _!=="number"){return b1("The iIndex parameter has to be a number");}if(this._getStringType()===u.ResponsiveTable){this._oTable.scrollToIndex(_).then(a1).catch(b1);}else{if(_===-1){_=this.getRowBinding()?this.getRowBinding().getLength():0;}if(this._oTable._setFirstVisibleRowIndex(_)){this._oTable.attachEventOnce("rowsUpdated",function(){a1();});}else{a1();}}}.bind(this));};H.prototype.focusRow=function(_,a1){return this.scrollToIndex(_).then(function(){return this._oTable._setFocus(_,a1);}.bind(this));};H.prototype.setType=function(_){var a1=this._getStringType(_);var b1=this._getStringType();this.setAggregation("type",_,true);if(a1===b1&&this._oTable){this._updateTypeSettings();return this;}if(this.bCreated){if(this._oTable){if(b1==="ResponsiveTable"){this._oTable.setHeaderToolbar();}else{this._oTable.removeExtension(this._oToolbar);}this._oTable.destroy("KeepDom");this._oTable=null;this._bTableExists=false;}else{this._onAfterTableCreated();this._onAfterFullInitialization();}if(this._oTemplate){this._oTemplate.destroy();this._oTemplate=null;}this._oTableReady=new h();this._oFullInitialize=new h();this._bFullyInitialized=false;this._initializeContent();}return this;};H.prototype.setRowSettings=function(_){var a1=this._getStringType();this.setAggregation("rowSettings",_,true);if(this._oTable){if(a1==="ResponsiveTable"){R.updateRowSettings(this._oTemplate,_);}else{G.updateRowSettings(this._oTable,_);}this._bForceRebind=true;this.checkAndRebind();}return this;};H.prototype.setHeaderLevel=function(_){if(this.getHeaderLevel()===_){return this;}this.setProperty("headerLevel",_,true);this._oTitle&&this._oTitle.setLevel(_);return this;};H.prototype.focus=function(_){var a1=this.getDomRef();if(this._oTable&&a1&&!e(a1,document.activeElement)){this._oTable.focus();}};H.prototype.setBusy=function(_){this.setProperty('busy',_,true);if(this._oTable){this._oTable.setBusy(_);}return this;};H.prototype.setBusyIndicatorDelay=function(_){this.setProperty('busyIndicatorDelay',_,true);if(this._oTable){this._oTable.setBusyIndicatorDelay(_);}return this;};H.prototype.setSelectionMode=function(_){var a1=this.getSelectionMode();this.setProperty("selectionMode",_,true);if(this._oTable&&a1!=this.getSelectionMode()){this._updateSelectionBehavior();}return this;};H.prototype.setRowAction=function(_){var a1=this.getRowAction();this.setProperty("rowAction",_,true);if(!g(a1.sort(),this.getRowAction().sort())){this._updateRowAction();}return this;};H.prototype.setCreationRow=function(_){this.setAggregation("creationRow",_,true);if(_){_.update();}return this;};H.prototype.setEnableColumnResize=function(_){var a1=this.getEnableColumnResize();this.setProperty("enableColumnResize",_,true);if(_!==a1){this._updateColumnResizer();}return this;};H.prototype.setP13nMode=function(_){var a1=this.getP13nMode();var b1=null;if(_&&_.length>1){b1=[];var c1=_.reduce(function(d1,e1,f1){d1[e1]=true;return d1;},{});if(c1.Column){b1.push("Column");}if(c1.Sort){b1.push("Sort");}if(c1.Filter){b1.push("Filter");}if(c1.Group){b1.push("Group");}if(c1.Aggregate){b1.push("Aggregate");}}else{b1=_;}this.setProperty("p13nMode",b1,true);this._updateAdaptation(this.getP13nMode());if(!g(a1.sort(),this.getP13nMode().sort())){Q(this);}return this;};H.prototype._updateAdaptation=function(_){var a1={controller:{}};var b1={Column:k,Sort:m,Group:o,Filter:n,Aggregate:p};_.forEach(function(c1){var d1=c1;a1.controller[d1]=b1[c1];});this.getEngine().registerAdaptation(this,a1);};function Q(_){if(_._oToolbar){_._oToolbar.destroyEnd();_._getP13nButtons().forEach(function(b1){_._oToolbar.addEnd(b1);});}if(_._oTable){var a1=_._oTable.getDragDropConfig()[0];if(a1){a1.setEnabled(_.getP13nMode().indexOf("Column")>-1);}}if(_.isFilteringEnabled()){V(_);}U(_);}H.prototype.setFilterConditions=function(_){this.setProperty("filterConditions",_,true);var a1=this.getInbuiltFilter();if(a1){a1.setFilterConditions(_);}U(this);return this;};function U(_){var a1=X(_);var b1=Y(_);var c1=Z(_);if(!a1){return;}if(c1.length===0||!_.isFilteringEnabled()){var d1=a1.getDomRef();if(d1&&d1.contains(document.activeElement)){_.focus();}a1.setVisible(false);return;}_._fullyInitialized().then(function(){var e1=c1.map(function(i1){return _.getPropertyHelper().getLabel(i1);});var f1=d.getLibraryResourceBundle("sap.ui.mdc");var g1=L.getInstance();var h1=f1.getText("table.FILTER_INFO",g1.format(e1));a1.setVisible(true);b1.setText(h1);});}function V(_){if(!_._oTable){return;}var a1=X(_);if(!a1){a1=W(_);}if(_._bMobileTable){if(_._oTable.getInfoToolbar()!==a1){_._oTable.setInfoToolbar(a1);_._oTable.addAriaLabelledBy(Y(_));}}else if(_._oTable.indexOfExtension(a1)===-1){_._oTable.insertExtension(a1,1);_._oTable.addAriaLabelledBy(Y(_));}}function W(_){var a1=_.getId()+"-filterInfoBar";var b1=B(_).oFilterInfoBar;if(b1&&!b1.bIsDestroyed){b1.destroy();}b1=new O({id:a1,active:true,design:w.Info,visible:false,content:[new a({id:a1+"-text",wrapping:false})],press:function(){T.showPanel(_,"Filter",b1);}});b1.focus=function(){if(this.getDomRef()){O.prototype.focus.apply(this,arguments);}else{_.focus();}};B(_).oFilterInfoBar=b1;U(_);return b1;}function X(_){var a1=B(_).oFilterInfoBar;if(a1&&(a1.bIsDestroyed||a1.bIsBeingDestroyed)){return null;}return B(_).oFilterInfoBar;}function Y(_){var a1=X(_);return a1?a1.getContent()[0]:null;}H.prototype.setThreshold=function(_){this.setProperty("threshold",_,true);if(!this._oTable){return this;}_=this.getThreshold()>-1?this.getThreshold():undefined;if(this._bMobileTable){this._oTable.setGrowingThreshold(_);}else{this._oTable.setThreshold(_);}return this;};H.prototype._onFilterProvided=function(_){this._updateInnerTableNoDataText();};H.prototype._onFilterRemoved=function(_){this._updateInnerTableNoDataText();};H.prototype._onFiltersChanged=function(_){if(this.isTableBound()&&_.getParameter("conditionsBased")){this._oTable.setShowOverlay(true);}};H.prototype._onFilterSearch=function(_){this._bIgnoreChange=true;this._bAnnounceTableUpdate=true;};H.prototype.setNoDataText=function(_){this.setProperty("noDataText",_,true);this._updateInnerTableNoDataText();return this;};H.prototype._updateInnerTableNoDataText=function(){if(!this._oTable){return;}var _=this._getNoDataText();if(this._bMobileTable){this._oTable.setNoDataText(_);}else{this._oTable.setNoData(_);}};H.prototype._getNoDataText=function(){var _=this.getNoDataText();if(_){return _;}var a1=d.getLibraryResourceBundle("sap.ui.mdc");if(!this.isTableBound()){if(this.getFilter()){return a1.getText("table.NO_DATA_WITH_FILTERBAR");}return a1.getText("table.NO_DATA");}return a1.getText("table.NO_RESULTS");};H.prototype._updateRowAction=function(){if(!this._oTable){return;}var _=this.getRowAction().indexOf(v.Navigation)>-1;var a1=this._bMobileTable?R:G;a1.updateRowAction(this,_,this._bMobileTable?undefined:this._onRowActionPress);};H.prototype._initializeContent=function(){var _,a1=this._getStringType();if(a1==="ResponsiveTable"){_=R;}else{_=G;}var b1=[this.awaitControlDelegate(),_.loadTableModules()];if(this.isFilteringEnabled()){b1.push(this.retrieveInbuiltFilter());}Promise.all(b1).then(function(){if(this.bIsDestroyed){return;}var c1=this.getControlDelegate();if(c1.preInit){this._pDelegatePreInit=c1.preInit(this);}if(!this._bTableExists&&a1===this._getStringType()){this._bMobileTable=a1==="ResponsiveTable";this._createContent();this._bTableExists=true;}}.bind(this)).catch(function(){this._onAfterTableCreated();}.bind(this));};H.prototype._doOneTimeOperations=function(){if(!this.bColumnsOrdered){this.bColumnsOrdered=true;this._orderColumns();}};H.prototype._onAfterTableCreated=function(_){this._oTableReady[_?"resolve":"reject"](this);};H.prototype._onAfterFullInitialization=function(_){this._oFullInitialize[_?"resolve":"reject"](this);};H.prototype._createContent=function(){this._createToolbar();this._createTable();this._updateColumnResizer();this._updateRowAction();this.getColumns().forEach(this._insertInnerColumn,this);this.setAggregation("_content",this._oTable);this._onAfterTableCreated(true);var _=this.initialized().then(function(){this.initPropertyHelper(P);var a1=this.getCreationRow();if(a1){a1.update();}if(this.getAutoBindOnInit()){this.checkAndRebind();}return this.awaitPropertyHelper();}.bind(this));Promise.all([_,this._pDelegatePreInit]).then(function(){delete this._pDelegatePreInit;this._bFullyInitialized=true;this._onAfterFullInitialization(true);}.bind(this)).catch(function(){this._onAfterFullInitialization();}.bind(this));};H.prototype.setHeader=function(_){this.setProperty("header",_,true);this._updateHeaderText();this._updateExportState(true);return this;};H.prototype.setHeaderVisible=function(_){this.setProperty("headerVisible",_,true);if(this._oTitle){this._oTitle.setWidth(this.getHeaderVisible()?undefined:"0px");}return this;};H.prototype.setEnableExport=function(_){if(_!==this.getEnableExport()){this.setProperty("enableExport",_,true);if(_&&!this._oExportButton&&this._oToolbar){this._oToolbar.addEnd(this._getExportButton());}else if(this._oExportButton){this._oExportButton.setVisible(_);}}return this;};H.prototype._createToolbar=function(){if(!this._oToolbar){this._oTitle=new b(this.getId()+"-title",{text:this.getHeader(),width:this.getHeaderVisible()?undefined:"0px",level:this.getHeaderLevel()});this._oToolbar=new A(this.getId()+"-toolbar",{design:w.Transparent,style:this._getStringType()===u.ResponsiveTable?x.Standard:x.Clear,begin:[this._oTitle],end:[this._getP13nButtons(),this._getExportButton()]});}return this._oToolbar;};H.prototype._getVisibleProperties=function(){var _=[],a1;this.getColumns().forEach(function(b1,c1){a1=b1&&b1.getDataProperty();if(a1){_.push({name:a1});}});return _;};H.prototype.getConditions=function(){return this.getInbuiltFilter()?this.getInbuiltFilter().getConditions():[];};H.prototype._getSortedProperties=function(){return this.getSortConditions()?this.getSortConditions().sorters:[];};H.prototype._getGroupedProperties=function(){return this.getGroupConditions()?this.getGroupConditions().groupLevels:[];};H.prototype._getAggregatedProperties=function(){return this.getAggregateConditions()?this.getAggregateConditions():{};};function Z(_){var a1=_.getFilterConditions();return Object.keys(a1).filter(function(b1){return a1[b1].length>0;});}H.prototype.getCurrentState=function(){var _={};var a1=this.getP13nMode();if(a1.indexOf("Column")>-1){_.items=this._getVisibleProperties();}if(this.isSortingEnabled()){_.sorters=this._getSortedProperties();}if(this.isFilteringEnabled()){_.filter=this.getFilterConditions();}if(this.isGroupingEnabled()){_.groupLevels=this._getGroupedProperties();}if(this.isAggregationEnabled()){_.aggregations=this._getAggregatedProperties();}return _;};H.prototype.isFilteringEnabled=function(){return this.getP13nMode().indexOf("Filter")>-1;};H.prototype.isSortingEnabled=function(){return this.getP13nMode().indexOf("Sort")>-1;};H.prototype.isGroupingEnabled=function(){return this.getP13nMode().indexOf("Group")>-1;};H.prototype.isAggregationEnabled=function(){return this.getP13nMode().indexOf("Aggregate")>-1;};H.prototype._getP13nButtons=function(){var _=this.getP13nMode();var a1=[];if(this.isSortingEnabled()&&!this._bNewP13n){a1.push(T.createSortButton(this.getId(),[this._showSort,this]));}if(this.isFilteringEnabled()&&!this._bNewP13n){a1.push(T.createFilterButton(this.getId(),[this._showFilter,this]));}if(_.indexOf("Column")>-1||(this._bNewP13n&&_.length>0)){a1.push(T.createColumnsButton(this.getId(),[this._showSettings,this]));}if(this.isGroupingEnabled()&&!this._bNewP13n){a1.push(T.createGroupButton(this.getId(),[this._showGroup,this]));}return a1;};H.prototype._getExportButton=function(){if(!this.getEnableExport()){return null;}var _={fileName:this.getHeader()};if(!this._cachedExportSettings){this._cachedExportSettings=_;}if(!this._oExportButton){this._oExportButton=T.createExportButton(this.getId(),{"default":[function(){this._onExport(_);},this],"exportAs":[this._onExportAs,this]});}this._updateExportState();return this._oExportButton;};H.prototype._updateExportState=function(_){var a1=this._getRowBinding();if(this._oExportButton){this._oExportButton.setEnabled(!!(a1&&a1.getLength()>0));if(_&&this._cachedExportSettings){this._cachedExportSettings.fileName=this.getHeader();}}};H.prototype._createExportColumnConfiguration=function(_){var a1=_&&_.splitCells;var b1=this.getColumns();return this._fullyInitialized().then(function(){var c1=this.getPropertyHelper();var d1=[];b1.forEach(function(e1){var f1=c1.getColumnExportSettings(e1,a1);d1=d1.concat(f1);},this);return[d1,c1];}.bind(this));};H.prototype._onExport=function(_){return this._createExportColumnConfiguration(_).then(function(a1){var b1=a1[0];var c1=a1[1];if(!b1||!b1.length){sap.ui.require(["sap/m/MessageBox"],function(f1){f1.error(d.getLibraryResourceBundle("sap.ui.mdc").getText("table.NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});}.bind(this));return;}var d1=this._getRowBinding();var e1={workbook:{columns:b1},dataSource:d1,fileName:_?_.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(["sap/ui/export/ExportUtils","sap/ui/export/Spreadsheet"],function(f1,g1){var h1=Promise.resolve();if(_.includeFilterSettings){h1=f1.parseFilterConfiguration(d1,function(i1){return c1.getLabel(i1);}).then(function(i1){if(i1){e1.workbook.context={metaSheetName:i1.name,metainfo:[i1]};}});}h1.then(function(){var i1={splitCells:false,includeFilterSettings:false};if(_){i1.splitCells=_.splitCells;i1.includeFilterSettings=_.includeFilterSettings;}var j1=new g1(e1);j1.attachBeforeExport(function(k1){var l1=k1.getParameter("exportSettings");var m1=this.getCurrentState();if((Array.isArray(m1.groupLevels)&&m1.groupLevels.length>0)||(m1.aggregations&&Object.keys(m1.aggregations).length>0)){l1.dataSource.count=null;}this.fireBeforeExport({exportSettings:l1,userExportSettings:i1});},this);j1.build().finally(function(){j1.destroy();});}.bind(this));}.bind(this));}.bind(this));}.bind(this));};H.prototype._onExportAs=function(){var _=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(a1){a1.getExportSettingsViaDialog(_._cachedExportSettings,_).then(function(b1){_._cachedExportSettings=b1;_._onExport(b1);});});});};H.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=d.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};H.prototype.onkeydown=function(_){if(_.isMarked()){return;}if((_.metaKey||_.ctrlKey)&&_.shiftKey&&_.which===K.E){if(this.getEnableExport()&&this._oExportButton&&this._oExportButton.getEnabled()){this._onExportAs();_.setMarked();_.preventDefault();}}if((_.metaKey||_.ctrlKey)&&_.which===K.COMMA){var a1=d.byId(this.getId()+"-settings");if(a1&&a1.getEnabled()&&a1.getVisible()){a1.firePress();_.setMarked();_.preventDefault();}}};H.prototype._createTable=function(){var _=this.getThreshold()>-1?this.getThreshold():undefined;var a1=this.getRowSettings()?this.getRowSettings().getAllSettings():{};if(this._bMobileTable){this._oTable=R.createTable(this.getId()+"-innerTable",{autoPopinMode:true,contextualWidth:"Auto",growing:true,sticky:["ColumnHeaders","HeaderToolbar","InfoToolbar"],itemPress:[this._onItemPress,this],selectionChange:[this._onSelectionChange,this],growingThreshold:_,noDataText:this._getNoDataText(),headerToolbar:this._oToolbar,ariaLabelledBy:[this._oTitle]});this._oTemplate=R.createTemplate(this.getId()+"-innerTableRow",a1);this._createColumn=H.prototype._createMobileColumn;this._sAggregation="items";this._oTable.bindRows=this._oTable.bindItems;this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onResponsiveTableColumnPress,this);}else{this._oTable=G.createTable(this.getId()+"-innerTable",{enableBusyIndicator:true,enableColumnReordering:false,threshold:_,cellClick:[this._onCellClick,this],noData:this._getNoDataText(),extension:[this._oToolbar],ariaLabelledBy:[this._oTitle],plugins:[G.createMultiSelectionPlugin(this,[this._onRowSelectionChange,this])],columnSelect:[this._onGridTableColumnPress,this],rowSettingsTemplate:a1});this._createColumn=H.prototype._createColumn;this._sAggregation="rows";}this._updateTypeSettings();this._updateSelectionBehavior();var b1=new D({sourceAggregation:"columns",targetAggregation:"columns",dropPosition:"Between",enabled:this.getP13nMode().indexOf("Column")>-1,drop:[this._onColumnRearrange,this]});b1.bIgnoreMetadataCheck=true;this._oTable.addDragDropConfig(b1);this._oTable.setBusyIndicatorDelay(this.getBusyIndicatorDelay());this._oTable.attachPaste(this._onInnerTablePaste,this);if(this.isFilteringEnabled()){V(this);}};H.prototype._updateColumnResizer=function(){if(!this._oTable){return;}var _=this.getEnableColumnResize();var a1=this._bMobileTable?R:G;if(_){a1.enableColumnResizer(this._oTable);}else{a1.disableColumnResizer(this._oTable);}};H.prototype._updateSelectionBehavior=function(){var _=this._bMobileTable?R:G;_.updateSelection(this);};H.prototype._onColumnRearrange=function(_){var a1=_.getParameter("draggedControl");var b1=_.getParameter("droppedControl");if(a1===b1){return;}var c1=_.getParameter("dropPosition");var d1=this._oTable.indexOfColumn(a1);var e1=this._oTable.indexOfColumn(b1);var f1=e1+(c1=="Before"?0:1)+(d1<e1?-1:0);T.moveColumn(this,d1,f1);};H.prototype._onColumnPress=function(_){var a1,b1=_.getParent(),c1,d1=window.matchMedia("(hover:none)").matches&&this._bMobileTable&&this.getEnableColumnResize();a1=b1.indexOfColumn(_);c1=this.getColumns()[a1];this._fullyInitialized().then(function(){var e1=d.getLibraryResourceBundle("sap.ui.mdc");if(this._oPopover){this._oPopover.destroy();this._oPopover=null;}if(this.isSortingEnabled()){var f1=[],g1=[];this.getPropertyHelper().getSortableProperties(c1.getDataProperty()).forEach(function(l1){f1.push(new I({text:l1.getLabel(),key:l1.getName()}));g1.push(new I({text:l1.getLabel(),key:l1.getName()}));});if(f1.length>0){this._oPopover=new c({items:[new q({items:f1,label:e1.getText("table.SETTINGS_ASCENDING"),icon:"sap-icon://sort-ascending",action:[false,this._onCustomSort,this]}),new q({items:g1,label:e1.getText("table.SETTINGS_DESCENDING"),icon:"sap-icon://sort-descending",action:[true,this._onCustomSort,this]})]});_.addDependent(this._oPopover);}}var h1=[];var i1=this.getControlDelegate();h1=(i1.addColumnMenuItems&&i1.addColumnMenuItems(this,c1))||[];if(this.isFilteringEnabled()){var j1=new q({label:e1.getText("table.SETTINGS_FILTER"),icon:"sap-icon://filter",action:[this._showFilter,this]});h1.unshift(j1);}if(d1){var k1=new r({text:e1.getText("table.SETTINGS_RP_RESIZE"),icon:"sap-icon://resize-horizontal",press:[_,this._onColumnResize,this]});h1.push(k1);}h1&&h1.forEach(function(l1){l1&&this._createPopover(l1,_);}.bind(this));this._oPopover&&this._oPopover.openBy(_);}.bind(this));};H.prototype._createPopover=function(_,a1){if(this._oPopover){this._oPopover.addItem(_);}else{this._oPopover=new c({items:_});a1.addDependent(this._oPopover);}};H.prototype._onCustomSort=function(_,a1){var b1=_.getParameter("property");T.createSort(this,b1,a1,true);};H.prototype._onColumnResize=function(_,a1){R.startColumnResize(this._oTable,a1);};H.prototype._onCustomGroup=function(_){T.createGroup(this,_);};H.prototype._onCustomAggregate=function(_){T.createAggregation(this,_);};H.prototype._insertInnerColumn=function(_,a1){if(!this._oTable){return;}var b1=this._createColumn(_);$(this,_,b1,a1);this._bForceRebind=true;if(a1===undefined){this._oTable.addColumn(b1);}else{this._oTable.insertColumn(b1,a1);}};H.prototype._orderColumns=function(){var _,a1=[],b1=this.getColumns();b1.forEach(function(c1){_=c1.getInitialIndex();if(_>-1){a1.push({index:_,column:this.removeColumn(c1)});}},this);a1.sort(function(c1,d1){return c1-d1;});a1.forEach(function(c1){this.insertColumn(c1.column,c1.index);},this);};function $(_,a1,b1,c1){var d1=a1.getTemplate(true);if(!_._bMobileTable){var e1=a1.getCreationTemplate(true);[d1,e1].forEach(function(f1){if(!f1){return;}if(f1.setWrapping){f1.setWrapping(false);}if(f1.setRenderWhitespace){f1.setRenderWhitespace(false);}});b1.setTemplate(d1);b1.setCreationTemplate(e1);}else if(c1>=0){_._oTemplate.insertCell(d1,c1);_._oTable.getItems().forEach(function(f1){f1.insertAggregation("cells",new j(),c1,true);});}else{_._oTemplate.addCell(d1);}}H.prototype._createColumn=function(_){return G.createColumn(_.getId()+"-innerColumn",{width:_.getWidth(),minWidth:Math.round(_.getMinWidth()*parseFloat(M.BaseFontSize)),hAlign:_.getHAlign(),label:_.getColumnHeaderControl(this._bMobileTable),resizable:this.getEnableColumnResize(),autoResizable:this.getEnableColumnResize()});};H.prototype._createMobileColumn=function(_){return R.createColumn(_.getId()+"-innerColumn",{width:_.getWidth(),autoPopinWidth:_.getMinWidth(),hAlign:_.getHAlign(),header:_.getColumnHeaderControl(this._bMobileTable),importance:_.getImportance(),popinDisplay:"Inline"});};H.prototype.moveColumn=function(_,a1){var b1;this.removeAggregation("columns",_,true);this.insertAggregation("columns",_,a1,true);if(this._oTable){b1=this._oTable.removeColumn(_.getId()+"-innerColumn");this._oTable.insertColumn(b1,a1);if(this._bMobileTable){this._updateColumnTemplate(_,a1);}}};H.prototype.removeColumn=function(_){_=this.removeAggregation("columns",_,true);if(this._oTable){var a1=this._oTable.removeColumn(_.getId()+"-innerColumn");a1.destroy();if(this._bMobileTable){this._updateColumnTemplate(_,-1);}}return _;};H.prototype.addColumn=function(_){this.addAggregation("columns",_,true);this._insertInnerColumn(_);return this;};H.prototype.insertColumn=function(_,a1){this.insertAggregation("columns",_,a1,true);this._insertInnerColumn(_,a1);return this;};H.prototype._updateColumnTemplate=function(_,a1){var b1,c1;if(this._oTemplate){b1=_.getTemplate(true);c1=this._oTemplate.indexOfCell(b1);H._removeItemCell(this._oTemplate,c1,a1);}if(c1>-1){this._oTable.getItems().forEach(function(d1){if(d1.removeCell){H._removeItemCell(d1,c1,a1);}});}};H._removeItemCell=function(_,a1,b1){var c1=_.removeCell(a1);if(c1){if(b1>-1){_.insertCell(c1,b1);}else{c1.destroy();}}};H.prototype._onItemPress=function(_){this.fireRowPress({bindingContext:_.getParameter("listItem").getBindingContext()});};H.prototype._onSelectionChange=function(_){var a1=_.getParameter("selectAll");this.fireSelectionChange({bindingContext:_.getParameter("listItem").getBindingContext(),selected:_.getParameter("selected"),selectAll:a1});if(a1){var b1=this.getRowBinding();if(b1&&this._oTable){var c1=b1.getLength();var d1=this._oTable.getItems().length;var e1=b1.isLengthFinal();if(d1!=c1||!e1){E("table.SELECTION_LIMIT_MESSAGE",[d1]);}}}};H.prototype._onResponsiveTableColumnPress=function(_){this._onColumnPress(_.getParameter("column"));};H.prototype._onCellClick=function(_){this.fireRowPress({bindingContext:_.getParameter("rowBindingContext")});};H.prototype._onRowActionPress=function(_){var a1=_.getParameter("row");this.fireRowPress({bindingContext:a1.getBindingContext()});};H.prototype._onRowSelectionChange=function(_){if(!this._bSelectionChangedByAPI){this.fireSelectionChange({bindingContext:_.getParameter("rowContext"),selected:_.getSource().isIndexSelected(_.getParameter("rowIndex")),selectAll:_.getParameter("selectAll")});}};H.prototype._onGridTableColumnPress=function(_){_.preventDefault();this._onColumnPress(_.getParameter("column"));};H.prototype.getSelectedContexts=function(){if(this._oTable){if(this._bMobileTable){return this._oTable.getSelectedContexts();}var _=this._oTable.getPlugins()[0].getSelectedIndices();return _.map(function(a1){return this._oTable.getContextByIndex(a1);},this);}return[];};H.prototype.clearSelection=function(){if(this._oTable){if(this._bMobileTable){this._oTable.removeSelections(true);}else{this._bSelectionChangedByAPI=true;this._oTable.getPlugins()[0].clearSelection();this._bSelectionChangedByAPI=false;}}};H.prototype._registerInnerFilter=function(_){_.attachSearch(function(){this.rebind();},this);};H.prototype.isTableBound=function(){return this._oTable?this._oTable.isBound(this._bMobileTable?"items":"rows"):false;};H.prototype.bindRows=function(){if(!this.bDelegateInitialized||!this._oTable){return;}var _={parameters:{},filters:[],sorter:this._getSorters()};this.getControlDelegate().updateBindingInfo(this,this.getPayload(),_);if(_.path){this._oTable.setShowOverlay(false);if(this._bMobileTable&&this._oTemplate){_.template=this._oTemplate;}else{delete _.template;}H._addBindingListener(_,"dataRequested",this._onDataRequested.bind(this));H._addBindingListener(_,"dataReceived",this._onDataReceived.bind(this));H._addBindingListener(_,"change",this._onBindingChange.bind(this));this._updateColumnsBeforeBinding(_);this.getControlDelegate().updateBinding(this,_,this._bForceRebind?null:this.getRowBinding());this._updateInnerTableNoDataText();this._bForceRebind=false;}};H.prototype._onDataRequested=function(){this._bIgnoreChange=true;};H.prototype._onDataReceived=function(){this._bIgnoreChange=false;this._updateHeaderText();this._updateExportState();};H.prototype._onBindingChange=function(){if(this._bIgnoreChange){return;}this._updateHeaderText();};H.prototype._updateHeaderText=function(){var _,a1;if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}if(this._oTitle&&this.getHeader()){_=this.getHeader();if(this.getShowRowCount()){a1=this._getRowCount();var b1=this._oNumberFormatInstance.format(a1);if(b1){_+=" ("+b1+")";}}this._oTitle.setText(_);}if(!this._bIgnoreChange&&this._bAnnounceTableUpdate){this._bAnnounceTableUpdate=false;this._announceTableUpdate(a1);}};H.prototype._announceTableUpdate=function(_){var a1=i.getInstance();if(a1){var b1=d.getLibraryResourceBundle("sap.ui.mdc");var c1=this.getHeader();if(_===undefined&&this._getRowCount()>0){a1.announce(b1.getText("table.ANNOUNCEMENT_TABLE_UPDATED",[c1]));}else if(_>1){a1.announce(b1.getText("table.ANNOUNCEMENT_TABLE_UPDATED_MULT",[c1,_]));}else if(_===1){a1.announce(b1.getText("table.ANNOUNCEMENT_TABLE_UPDATED_SING",[c1,_]));}else{a1.announce(b1.getText("table.ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[c1]));}}};H.prototype._updateColumnsBeforeBinding=function(_){var a1=[].concat(_.sorter||[]);var b1=this.getColumns();var c1=this._bMobileTable;var d1=this.getPropertyHelper();b1.forEach(function(e1){var f1=d.byId(e1.getId()+"-innerColumn");var g1=d1.getSortableProperties(e1.getDataProperty()).map(function(j1){return j1.getPath();});if(g1.length>0){var h1=a1.find(function(h1){return g1.indexOf(h1.sPath)>-1;});var i1=h1&&h1.bDescending?"Descending":"Ascending";if(c1){f1.setSortIndicator(h1?i1:"None");}else{f1.setSorted(!!h1).setSortOrder(i1);}}});};H.prototype._getRowCount=function(){var _=this._getRowBinding();if(!_){return 0;}var a1;if(_.isLengthFinal()){a1=_.getLength();}if(a1<0||a1==="0"){a1=0;}return a1;};H.prototype.getRowBinding=function(){return this._getRowBinding();};H.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};H._addBindingListener=function(_,a1,b1){if(!_.events){_.events={};}if(!_.events[a1]){_.events[a1]=b1;}else{var c1=_.events[a1];_.events[a1]=function(){b1.apply(this,arguments);c1.apply(this,arguments);};}};H.prototype.rebindTable=function(){this.rebind();};H.prototype.rebind=function(){if(this._bFullyInitialized){this.bindRows();}else{this._fullyInitialized().then(this.rebind.bind(this));}};H.prototype._showSettings=function(_){T.showPanel(this,"Columns",_.getSource());};H.prototype._showSort=function(_){T.showPanel(this,"Sort",_.getSource());};H.prototype._showFilter=function(_){T.showPanel(this,"Filter",_.getSource());};H.prototype._showGroup=function(_){T.showPanel(this,"Group",_.getSource());};H.prototype._getSorters=function(){var _=this.getSortConditions()?this.getSortConditions().sorters:[];var a1=[],b1=this.getPropertyHelper();_.forEach(function(c1){var d1=b1.getPath(c1.name);a1.push(new S(d1,c1.descending));});return a1;};H.prototype._onInnerTablePaste=function(_){this.firePaste({data:_.getParameter("data")});};H.prototype.exit=function(){if(this._oTemplate){this._oTemplate.destroy();}this._bNewP13n=null;this._oTemplate=null;this._oTable=null;if(this._oToolbar&&!this._bTableExists){this._oToolbar.destroy();}this._oToolbar=null;this._oTitle=null;this._oNumberFormatInstance=null;J.forEach(function(_){var a1=f(_),b1="_o"+a1;this[b1]=null;},this);this._oTableReady=null;this._oFullInitialize=null;C.prototype.exit.apply(this,arguments);};return H;});
