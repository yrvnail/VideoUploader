/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/base/Object','sap/ui/mdc/p13n/FlexUtil','sap/ui/mdc/p13n/P13nBuilder','sap/base/util/merge','sap/base/util/deepEqual','sap/ui/model/json/JSONModel','sap/ui/mdc/p13n/panels/SelectionPanel'],function(B,F,P,m,d,J,S){"use strict";var a=B.extend("sap.ui.mdc.p13n.subcontroller.BaseController",{constructor:function(c){B.call(this);this._oAdaptationControl=c;this._oP13nData=null;this._bLiveMode=false;this._bResetEnabled=false;}});a.prototype.getContainerSettings=function(){return{title:"Adaptation Dialog"};};a.prototype.getAdaptationControl=function(){return this._oAdaptationControl;};a.prototype.getLiveMode=function(){return this._bLiveMode;};a.prototype.getChangeOperations=function(){return{add:null,remove:null,move:null};};a.prototype.getResetEnabled=function(){return this._bResetEnabled;};a.prototype.sanityCheck=function(s){return s;};a.prototype.getAdaptationUI=function(p){var s=new S();var A=this._getP13nModel(p);s.setP13nModel(A);this._oPanel=s;return Promise.resolve(s);};a.prototype.getCurrentState=function(){return this._oAdaptationControl.getCurrentState().items;};a.prototype.getDelta=function(p){var s=this._getPresenceAttribute(p.externalAppliance);var n;var f=function(i){return i.hasOwnProperty(s)&&i[s]===false?false:true;};n=p.applyAbsolute?p.changedState.filter(f):this._getFilledArray(p.existingState,p.changedState,s).filter(f);p.changedState=n;if(d(p.existingState,n)){return[];}else{return F.getArrayDeltaChanges(p);}};a.prototype._getPresenceAttribute=function(b){return"visible";};a.prototype.getBeforeApply=function(){return Promise.resolve();};a.prototype.mixInfoAndState=function(p){var i=this.getCurrentState();var I=P.arrayToMap(i);var o=P.prepareAdaptationData(p,function(b,c){var e=I[c.name];b.visible=!!e;b.position=e?e.position:-1;return c.visible;});P.sortP13nData({visible:"visible",position:"position"},o.items);o.items.forEach(function(b){delete b.position;});return o;};a.prototype.getP13nData=function(){return this._oPanel?this._oPanel.getP13nState():this._oAdaptationModel.getProperty("/items");};a.prototype.model2State=false;a.prototype.update=function(p){if(this._oAdaptationModel){var o=this.mixInfoAndState(p);this._oAdaptationModel.setProperty("/items",o.items);this._oAdaptationModel.setProperty("/itemsGrouped",o.itemsGrouped);}};a.prototype._getFilledArray=function(p,n,r){var N=m([],p);var b=m([],n);var e=P.arrayToMap(p);b.forEach(function(i){var E=e[i.name];if(!i.hasOwnProperty(r)||i[r]){var c=i.position;if(E){c=c>-1?c:E.position;var o=E.position;N.splice(c,0,N.splice(o,1)[0]);}else{c=c>-1?c:N.length;N.splice(c,0,i);}N[c]=i;}else if(E){N[E.position][r]=false;}});return N;};a.prototype._getP13nModel=function(p){if(!this._oAdaptationModel){this._oAdaptationModel=new J(this.mixInfoAndState(p));this._oP13nData=this._oAdaptationModel.getData();this._oAdaptationModel.setSizeLimit(10000);}else{this.update(p);}return this._oAdaptationModel;};a.prototype.destroy=function(){B.prototype.destroy.apply(this,arguments);this._oAdaptationControl=null;this._bLiveMode=null;this._oPanel=null;this._bResetEnabled=null;this._oAdaptationModel=null;};return a;});
