/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/ui/core/mvc/View","sap/ui/core/Component"],function(L,O,V,C){"use strict";sap.ui.extensionpoint=function(c,e,f,t,a){L.warning("Do not use deprecated factory function 'sap.ui.extensionpoint'. Use 'sap.ui.core.ExtensionPoint.load' instead","sap.ui.extensionpoint",null,function(){return{type:"sap.ui.extensionpoint",name:e};});return E._factory(c,e,f,t,a);};var E=sap.ui.extensionpoint;E._factory=function(c,e,f,t,a){var o,v,r,s,b;if(c){if(c.isA("sap.ui.core.mvc.View")){s=c.sViewName;v=c;}else if(c.isA("sap.ui.core.Fragment")){s=c.getFragmentName();v=c._oContainingView;}if(!sap.ui.getCore().getConfiguration().getDisableCustomizing()){b=C.getOwnerComponentFor(c);if(b){if(b.getExtensionComponent){b=b.getExtensionComponent();if(!b){throw new Error("getExtensionComponent() must return an instance.");}}o=b._getManifestEntry("/sap.ui5/extends/extensions/sap.ui.viewExtensions/"+s+"/"+e,true);}}}if(o){if(o.className){var d=sap.ui.requireSync(o.className.replace(/\./g,"/"));d=d||O.get(o.className);var I=v&&o.id?v.createId(o.id):o.id;L.info("Customizing: View extension found for extension point '"+e+"' in View '"+v.sViewName+"': "+o.className+": "+(o.viewName||o.fragmentName));if(o.className==="sap.ui.core.Fragment"){var F=new d({id:I,type:o.type,fragmentName:o.fragmentName,containingView:v});r=(Array.isArray(F)?F:[F]);}else if(o.className==="sap.ui.core.mvc.View"){v=V._create({type:o.type,viewName:o.viewName,id:I});r=[v];}else{L.warning("Customizing: Unknown extension className configured (and ignored) in Component.js for extension point '"+e+"' in View '"+v.sViewName+"': "+o.className);}}else{L.warning("Customizing: no extension className configured in Component.js for extension point '"+e+"' in View '"+v.sViewName+"': "+o.className);}}else if(E._fnExtensionProvider){var g=E._fnExtensionProvider(v);var h;if(v.isA("sap.ui.core.Fragment")){h=v._sExplicitId;var j=v.getController();v=j&&typeof j.isA==="function"&&j.isA("sap.ui.core.mvc.Controller")&&j.getView();if(v){h=v.getLocalId(h)||h;}}if(g){if(!v){L.warning("View instance could not be passed to ExtensionPoint Provider for extension point '"+e+"' "+"in fragment '"+h+"'.");}return[{providerClass:g,view:v,fragmentId:h,name:e,createDefault:f,targetControl:undefined,aggregationName:undefined,index:undefined,ready:function(i){var n=this._nextSibling;while(n!=null){n.index+=i.length;n=n._nextSibling;}},_isExtensionPoint:true,_nextSibling:null}];}}if(!r&&typeof f==='function'){r=f();}var p=function(r){if(r&&!Array.isArray(r)){r=[r];}if(r&&t){var A=t.getMetadata().getAggregation(a);if(A){for(var i=0,l=r.length;i<l;i++){t[A._sMutator](r[i]);}}else{L.error("Creating extension point failed - Tried to add extension point with name "+e+" to an aggregation of "+t.getId()+" in view "+v.sViewName+", but sAggregationName was not provided correctly and I could not find a default aggregation");}}return r||[];};if(r&&typeof r.then==='function'){return r.then(p);}else{return p(r);}};E.registerExtensionProvider=function(e){if(e==null){delete E._fnExtensionProvider;}else if(typeof e=="function"){E._fnExtensionProvider=e;}else{L.error("ExtensionPoint provider must be a function!");}};E.load=function(o){return Promise.resolve(E._factory(o.container,o.name,o.createDefaultContent));};return E;});
