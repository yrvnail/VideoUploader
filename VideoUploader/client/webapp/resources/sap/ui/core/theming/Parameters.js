/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/URI','../Element','sap/base/util/UriParameters','sap/base/Log','sap/base/util/extend','sap/ui/core/ThemeCheck','sap/ui/thirdparty/jquery'],function(U,E,a,L,e,T,q){"use strict";var c=window["sap-ui-config"]||{};var s=0;if(c['xx-nosync']==='warn'||/(?:\?|&)sap-ui-xx-nosync=(?:warn)/.exec(window.location.search)){s=1;}if(c['xx-nosync']===true||c['xx-nosync']==='true'||/(?:\?|&)sap-ui-xx-nosync=(?:x|X|true)/.exec(window.location.search)){s=2;}var P={};var p=null;var t=null;var b=[];var C=[];var B=new U(sap.ui.require.toUrl(""),document.baseURI).origin();var o={};var r=/url[\s]*\('?"?([^\'")]*)'?"?\)/;var u=a.fromQuery(window.location.search).get("sap-ui-xx-no-inline-theming-parameters")!=="true";function d(){p=null;}function f(i,j){var M=r.exec(i);if(M){var k=new U(M[1]);if(k.is("relative")){var N=k.absoluteTo(j).normalize().toString();i="url('"+N+"')";}}return i;}function m(i,N,j){for(var k in N){if(typeof i[k]==="undefined"){i[k]=f(N[k],j);}}return i;}function g(N,i){if(typeof N["default"]!=="object"){N={"default":N,"scopes":{}};}p=p||{};p["default"]=p["default"]||{};p["scopes"]=p["scopes"]||{};m(p["default"],N["default"],i);if(typeof N["scopes"]==="object"){for(var S in N["scopes"]){p["scopes"][S]=p["scopes"][S]||{};m(p["scopes"][S],N["scopes"][S],i);}}}function h(i){q("link[id^=sap-ui-theme-]").each(function(){i(this.getAttribute("id"));});}function l(i){var j=v(i);var k=T.checkStyle(i);if(!k){L.warning("Parameters have been requested but theme is not applied, yet.","sap.ui.core.theming.Parameters");}if(k&&u){var $=q(document.getElementById(i));var F=$.css("background-image");var G=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)$/i.exec(F);if(G&&G.length>=2){var H=G[1];if(H.charAt(0)!=="{"&&H.charAt(H.length-1)!=="}"){try{H=decodeURIComponent(H);}catch(I){L.warning("Could not decode theme parameters URI from "+j.styleSheetUrl);}}try{var J=JSON.parse(H);g(J,j.themeBaseUrl);return true;}catch(I){L.warning("Could not parse theme parameters from "+j.styleSheetUrl+". Loading library-parameters.json as fallback solution.");}}}return false;}function n(i){var j=v(i);if(!l(i)){var k=j.styleSheetUrl.replace(/\/(?:css_variables|library)([^\/.]*)\.(?:css|less)($|[?#])/,function($,H,I){return"/library-parameters.json"+(I?I:"");});if(s===2){L.error("[nosync] Loading library-parameters.json ignored",k,"sap.ui.core.theming.Parameters");return;}else if(s===1){L.error("[nosync] Loading library-parameters.json with sync XHR",k,"sap.ui.core.theming.Parameters");}var F=new U(j.themeBaseUrl).origin();var W=o[F];var G=[];if(W===undefined){if(k.startsWith(B)){G=[false,true];}else{G=[true,false];}}else{G=[W];}w(k,j.themeBaseUrl,G);}}function v(i){var j=document.getElementById(i);if(!j){L.warning("Could not find stylesheet element with ID",i,"sap.ui.core.theming.Parameters");return undefined;}var S=j.href;return{themeBaseUrl:new U(S).filename("").query("").toString(),styleSheetUrl:S};}function w(i,k,W){var F=W.shift();var H=F?{"X-Requested-With":"XMLHttpRequest"}:{};q.ajax({url:i,dataType:'json',async:false,xhrFields:{withCredentials:F},headers:H,success:function(G,I,J){var K=new U(k).origin();o[K]=F;if(Array.isArray(G)){for(var j=0;j<G.length;j++){var M=G[j];g(M,k);}}else{g(G,k);}},error:function(j,G,I){L.error("Could not load theme parameters from: "+i,I);if(W.length>0){L.warning("Initial library-parameters.json request failed ('withCredentials="+F+"'; sUrl: '"+i+"').\n"+"Retrying with 'withCredentials="+!F+"'.","sap.ui.core.theming.Parameters");w(i,k,W);}}});}function x(i){if(!p){g({},"");t=sap.ui.getCore().getConfiguration().getTheme();h(function(I){if(i){if(T.checkStyle(I)){l(I);}else{b.push(I);}}else{n(I);}});}return p;}function y(){var i=[];b.forEach(function(I){if(T.checkStyle(I)){l(I);}else{i.push(I);}});b=i;}function z(){b.forEach(n);b=[];}P._addLibraryTheme=function(i){if(p){b.push("sap-ui-theme-"+i);}};function A(O){var i=O.async,j=x(i);if(O.scopeName){j=j["scopes"][O.scopeName];}else{j=j["default"];}var k=j[O.parameterName];if(typeof k==="undefined"&&typeof O.parameterName==="string"){var I=O.parameterName.indexOf(":");if(I!==-1){O.parameterName=O.parameterName.substr(I+1);}k=j[O.parameterName];}if(O.loadPendingParameters&&typeof k==="undefined"&&!i){z();k=A({parameterName:O.parameterName,scopeName:O.scopeName,loadPendingParameters:false});}return k;}function D(j,S,F){for(var i=0;i<S.length;i++){var G=S[i];for(var k=0;k<G.length;k++){var H=G[k];var I=A({parameterName:j,scopeName:H,async:F});if(I){return I;}}}return A({parameterName:j,async:F});}P._getScopes=function(i,j){if(i&&!p){return;}var k=x(j);var S=Object.keys(k["scopes"]);return S;};P.getActiveScopesFor=function(i,j){var S=[];if(i instanceof E){var k=i.getDomRef();if(j){y();}else{z();}var F=this._getScopes(undefined,j);if(F.length){if(k){var N=function(I){var J=k.classList;return J&&J.contains(I);};while(k){var G=F.filter(N);if(G.length>0){S.push(G);}k=k.parentNode;}}else{var H=function(I){return typeof i.hasStyleClass==="function"&&i.hasStyleClass(I);};while(i){var G=F.filter(H);if(G.length>0){S.push(G);}i=typeof i.getParent==="function"&&i.getParent();}}}}return S;};P.get=function(N,j){var k,F,G,H,I;var J=function(S){return S.callback===F;};if(!sap.ui.getCore().isInitialized()){L.warning("Called sap.ui.core.theming.Parameters.get() before core has been initialized. "+"This could lead to bad performance and sync XHR as inline parameters might not be available, yet. "+"Consider using the API only when required, e.g. onBeforeRendering.");}if(arguments.length===0){z();var K=x();return Object.assign({},K["default"]);}if(!N){return undefined;}if(N instanceof Object&&!Array.isArray(N)){if(!N.name){return undefined;}j=N.scopeElement;F=N.callback;H=typeof N.name==="string"?[N.name]:N.name;G=true;}else{if(typeof N==="string"){H=[N];}else{H=N;}L.warning("Legacy variant usage of sap.ui.core.theming.Parameters.get API detected for parameter(s): '"+H.join(", ")+"'. Use asynchronous variant instead.","LegacyParametersGet","sap.ui.support",function(){return{type:"LegacyParametersGet"};});}var M,R;var O=function(S){if(j instanceof E){var V=this.getActiveScopesFor(j,G);return D(S,V,G);}else{if(G){y();}return A({parameterName:S,loadPendingParameters:!G,async:G});}}.bind(this);R={};for(var i=0;i<H.length;i++){k=H[i];var Q=O(k);if(!G||Q){R[k]=Q;}}if(G&&F&&Object.keys(R).length!==H.length){if(!sap.ui.getCore().isThemeApplied()){M=function(){var S=this.get({name:N.name,scopeElement:N.scopeElement});if(!S||(typeof S==="object"&&(Object.keys(S).length!==H.length))){L.error("One or more parameters could not be found.","sap.ui.core.theming.Parameters");}F(S);C.splice(C.findIndex(J),1);sap.ui.getCore().detachThemeChanged(M);}.bind(this);I=C.findIndex(J);if(I>=0){sap.ui.getCore().detachThemeChanged(C[I].eventHandler);C[I].eventHandler=M;}else{C.push({callback:F,eventHandler:M});}sap.ui.getCore().attachThemeChanged(M);return undefined;}else{L.error("One or more parameters could not be found.","sap.ui.core.theming.Parameters");}}return H.length===1?R[H[0]]:R;};P._setOrLoadParameters=function(i){p={"default":{},"scopes":{}};t=sap.ui.getCore().getConfiguration().getTheme();h(function(I){var j=I.substr(13);if(i[j]){e(p["default"],i[j]);}else{n(I);}});};P.reset=function(){var O=arguments[0]===true;if(!O||sap.ui.getCore().getConfiguration().getTheme()!==t){d();}};P._getThemeImage=function(i,F){i=i||"sapUiGlobalLogo";var j=P.get(i);if(j){var k=r.exec(j);if(k){j=k[1];}else if(j==="''"||j==="none"){j=null;}}if(!!F&&!j){return sap.ui.resource('sap.ui.core','themes/base/img/1x1.gif');}return j;};return P;},true);
