/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/ResponsivePopover","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/VBox","sap/m/HBox","sap/m/Select","sap/ui/core/ListItem","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/CheckBox","sap/m/Menu","sap/m/MenuItem","sap/m/Input","sap/ui/integration/util/ParameterMap","sap/base/util/merge","sap/ui/core/Core"],function(C,P,J,B,S,b,V,H,c,L,d,T,e,f,M,g,I,h,m,j){"use strict";var k=C.extend("sap.ui.integration.designtime.editor.fields.Settings",{metadata:{},renderer:function(){}});k.prototype.setConfiguration=function(o){this._originalConfig=o;o=m({},o);var a=new J(o);this.setModel(a,"currentSettings");this.bindElement({path:"currentSettings>/"});};k.prototype.open=function(o,a,i,n,v,e1,f1){this.addDependent(z);this.oHost=n;this.fnApply=e1;this.fnCancel=f1;this._oOpener=v;p=true;o.addDependent(this);q=this;this.getModel("currentSettings").checkUpdate(true,true);b1(r.getText("CARDEDITOR_SELECT_FROM_LIST"),[]);if(a){var g1=i.getDomRef().offsetWidth===0?270:i.getDomRef().offsetWidth;z.setContentWidth(g1+"px");z.setContentHeight((i.getDomRef().offsetHeight-80)+"px");z.setPlacement("Right");u.setValue(o._label);z.openBy(o);}else{z.open();}l=this.getModel("currentSettings");if(l.getProperty("/_hasDynamicValue")){E();}else if(l.getProperty("/_hasSettings")){A();}else if(l.getProperty("/allowDynamicValues")){E();}else if(l.getProperty("/allowSettings")){A();}};var r=j.getLibraryResourceBundle("sap.ui.integration"),l,p,q=null,D,s,t,u,w,x,y,F;k.prototype._applyCurrentSettings=function(){this.fnApply(l.getData());};k.prototype._cancelCurrentSettings=function(){this.fnCancel(this._originalConfig);};k.prototype.destroy=function(){this.removeDependent(z);return C.prototype.destroy.apply(this,arguments);};var z=new P({showArrow:true,contentWidth:"400px",showHeader:false,horizontalScrolling:false,modal:false,endButton:new B({text:r.getText("CARDEDITOR_MORE_CANCEL"),press:function(){z.close();}}),beginButton:new B({text:r.getText("CARDEDITOR_MORE_OK"),type:"Emphasized",press:function(){q._applyCurrentSettings();p=false;z.close();}}),afterClose:function(){if(p){q._cancelCurrentSettings();}p=true;}});z.attachAfterOpen(function(){var o=this.getDomRef().querySelector("footer"),a=U.getDomRef();if(a.nextSibling!==o){o.parentNode.insertBefore(a,o);o.style.marginTop="0rem";a.style.display="flex";}var i=W.getDomRef(),n=o.querySelector("button").parentNode;if(i){n.insertBefore(i,n.firstChild);}window.requestAnimationFrame(function(){z.getDomRef()&&(z.getDomRef().style.opacity="1");});});function A(){s.setVisible(true);D.setVisible(false);G.setSelectedKey("settings");var o=U.getDomRef();window.requestAnimationFrame(function(){o&&(o.style.opacity="0");});}function E(){s.setVisible(false);D.setVisible(true);G.setSelectedKey("dynamic");var a=q.getModel("contextflat"),o=a._getValueObject(l.getProperty("/value"));if(o&&o.object.label){u.setValue(o.object.label);b1(o.object.description,o.object.tags);if(o.path==="empty"){u.setValue(o.object.label);}d1(o);}var i=U.getDomRef();window.requestAnimationFrame(function(){i&&(i.style.opacity="1");});}z.addStyleClass("sapUiIntegrationFieldSettings");var G=new S({width:"100%",visible:"{= ${currentSettings>allowDynamicValues} && ${currentSettings>allowSettings}}"});var K=new b({text:r.getText("CARDEDITOR_MORE_DYNAMICVALUES"),key:"dynamic",icon:"{= ${currentSettings>_hasDynamicValue} ? 'sap-icon://display-more' : 'sap-icon://enter-more'}",width:"50%",press:E});K.addStyleClass("dynbtn sel");var N=new b({text:r.getText("CARDEDITOR_MORE_SETTINGS"),key:"settings",icon:"sap-icon://action-settings",width:"50%",press:A});N.addStyleClass("setbtn");G.addItem(K);G.addItem(N);var O=new T({text:r.getText("CARDEDITOR_MORE_DYNAMICVALUES"),visible:"{= ${currentSettings>allowDynamicValues} && !${currentSettings>allowSettings}}"});O.addStyleClass("sapUiTinyMagin");var Q=new T({text:r.getText("CARDEDITOR_MORE_SETTINGS"),visible:"{= !${currentSettings>allowDynamicValues} && ${currentSettings>allowSettings}}"});Q.addStyleClass("sapUiTinyMagin");var R=new H({width:"100%",items:[G,O,Q]});R.addStyleClass("headertitle");var U=new V({width:"100%",items:[new T({text:r.getText("CARDEDITOR_ACTUAL_VALUE")}),new I({value:{path:"currentSettings>_currentContextValue"},editable:false})]});U.addStyleClass("currentval");var W=new B({type:"Transparent",text:r.getText("CARDEDITOR_MORE_RESET"),enabled:"{= ${currentSettings>_next/visible} === false || ${currentSettings>_next/editable} === false || ${currentSettings>_next/allowDynamicValues} === false || ${currentSettings>_beforeValue} !== ${currentSettings>value}}",tooltip:r.getText("CARDEDITOR_MORE_SETTINGS_P_ADMIN_RESET"),press:function(){Y("visible",true);Y("editable",true);Y("allowDynamicValues",true);if(l.getProperty("/translatable")){l.setProperty("/value",l.getProperty("/_translatedDefaultValue"));l.setProperty("/_changed",false);}else{l.setProperty("/value",l.getProperty("/_beforeValue"));}z.getBeginButton().firePress();}});W.addStyleClass("resetbutton");var X=new V({width:"100%",items:[R,U,W]});X.addStyleClass("tabs");z.setCustomHeader(X);function Y(a,v){if(!l.getProperty("/_next")){l.setProperty("/_next",{});}l.setProperty("/_next/"+a,v);}function Z(o,v){var a=[];for(var n in o){if(o[n]&&o[n].label){var e1=new g({text:o[n].label});e1.__data=o[n];o[n].pathvalue=(v+"/"+n).substring(1);a.push(e1);var f1=Z(o[n],v+"/"+n);for(var i=0;i<f1.length;i++){e1.addItem(f1[i]);}}}return a;}function $(){D=new V({visible:true});s=new V({visible:false});D.addStyleClass("sapUiSmallMargin");u=new I({width:"100%",showValueHelp:true,valueHelpOnly:true,valueHelpRequest:function(){if(w){w.destroy();}w=new M({});x=Z(D.getModel("context").getData(),"");for(var i=0;i<x.length;i++){w.addItem(x[i]);}w.attachItemSelected(function(a){var n=a.getParameter("item").__data;b1(n.description||"",n.tags||[]);u.setValue(n.placeholder||n.label);var e1=q.getModel("contextflat");d1(e1._getPathObject(n.pathvalue));});u.addDependent(w);w.addStyleClass("sapUiIntegrationFieldSettingsMenu");w.openBy(u,false,null,null,"1 0");}});u.addStyleClass("selectvariable");var v=new V({items:[new d({text:"Select a dynamic value"}),u]});D.addItem(v);t=new T({text:"",maxLines:6,renderWhitespace:true});v=new V({width:"100%",items:[t]});t.addStyleClass("description");D.addItem(v);if(_.length===-1){y=new c({width:"100%",enabled:true,change:function(){F.setText(y.getSelectedItem()._data.description);}});v=new V({visible:false,items:[new d({text:"Customize the value..."}),y]});D.addItem(v);F=new T({text:"",maxLines:4,renderWhitespace:true});F.addStyleClass("description");v=new V({width:"100%",items:[F]});D.addItem(v);D.getItems()[2].getItems()[0].addStyleClass("sapUiTinyMarginTop");}D.getItems()[0].getItems()[0].addStyleClass("sapUiTinyMarginTop");s.addStyleClass("sapUiSmallMargin");s.addItem(new H({items:[new e({text:r.getText("CARDEDITOR_MORE_SETTINGS_P_ADMIN")}),new B({type:"Transparent",tooltip:r.getText("CARDEDITOR_MORE_SETTINGS_P_ADMIN_RESET"),enabled:"{= ${currentSettings>_next/visible} === false || ${currentSettings>_next/editable} === false || ${currentSettings>_next/allowDynamicValues} === false}",icon:"sap-icon://reset",visible:false,press:function(){s.getItems()[1].getItems()[1].focus();Y("visible",true);Y("editable",true);Y("allowDynamicValues",true);}})]}));s.addItem(new H({items:[new d({text:r.getText("CARDEDITOR_MORE_SETTINGS_P_ADMIN_VISIBLE")}),new f({selected:"{= ${currentSettings>_next/visible} !== false}",select:function(a){Y("visible",a.getParameter("selected"));}})]}));s.addItem(new H({items:[new d({text:r.getText("CARDEDITOR_MORE_SETTINGS_P_ADMIN_EDIT")}),new f({selected:"{= ${currentSettings>_next/editable} !== false}",enabled:"{= ${currentSettings>_next/visible} !== false}",select:function(a){Y("editable",a.getParameter("selected"));}})]}));s.addItem(new H({visible:"{= ${currentSettings>allowDynamicValues}!== false}",items:[new d({text:r.getText("CARDEDITOR_MORE_SETTINGS_P_ADMIN_DYN")}),new f({selected:"{= ${currentSettings>_next/allowDynamicValues} !== false}",enabled:"{= ${currentSettings>_next/visible} !== false && ${currentSettings>_next/editable} !== false}",select:function(a){Y("allowDynamicValues",a.getParameter("selected"));}})]}));var o=s.getItems();o[0].addStyleClass("stitle");o[1].addStyleClass("cbrow");o[2].addStyleClass("cbrow");o[3].addStyleClass("cbrow");z.addContent(D);z.addContent(s);}var _=[{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Relative date/datetime text of the value",description:"Should be applied to dynamic values of type date or datetime or string values that represent a datetime in the format 'yyyy-MM-ddZhh:mm:ss'",example:"4 weeks ago",syntax:"handlebars",binding:"{= format.dateTime('__|VALUE|__',{relative:true})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Short date/datetime text of the value",description:"Should be applied to dynamic values of type date, date-time or text values that represent a datetime in the format 'yyyy-MM-ddZhh:mm:ss.sss'",example:"9/18/20, 2:09 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'short'})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Medium date/datetime text of the value",description:"Should be applied to dynamic values of type date, date-time or text values that represent a datetime in the format 'yyyy-MM-ddThh:mm:ss.sssZ'",example:"Sep 18, 2020, 2:09:04 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'medium'})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Long date, date-time text of the value",description:"Should be applied to dynamic values of type date or date-time or string values that represent a datetime in the format 'yyyy-MM-ddThh:mm:ss.sssZ'",example:"Sep 18, 2020, 2:09:04 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'long'})}"}];function a1(a,n){a=a||[];y.removeAllItems();var o=[];y.addItem(new L({text:"No customizing needed",key:""}));for(var i=0;i<_.length;i++){var v=_[i],e1=new L({text:v.label,key:"key"+i});e1._data=v;if(v.sourceTypes.indexOf(n)>-1||a.indexOf(v.formatMethod)>-1){y.addItem(e1);}else{o.push(e1);}}for(var i=0;i<o.length;i++){y.addItem(o[i]);}}$();function b1(a,i){i=i||[];if(i.indexOf("technical")>-1){a=a+"\n"+r.getText("CARDEDITOR_MORE_DYNAMICVALUES_TECHHINT");}t.setText(a);}function c1(o){if(_.length===-1){if(!o){y.removeAllItems();y.addItem(new L({text:"No customizing available for this value"}));F.setText("");y.setEnabled(false);}else{a1(o.customize,o.type);y.setEnabled(true);}}}function d1(o){if(o){l.setProperty("/_hasDynamicValue",true);var a=o.value;l.setProperty("/value",a);l.setProperty("/_contextpath",o.path);if(o.object&&o.object.value&&o.object.value.indexOf("{{")===0){l.setProperty("/_currentContextValue",h.processPredefinedParameter(o.object.value));c1(o.object);}else{if(o.path==="empty"){l.setProperty("/value","");l.setProperty("/_currentContextValue","");l.setProperty("/_hasDynamicValue",false);c1();}else{c1(o.object);if(o.object&&o.object.hasOwnProperty("value")){l.setProperty("/_currentContextValue",o.object.value);}else{q.oHost.getContextValue(o.path+"/value").then(function(v){if(v===null){l.setProperty("/_currentContextValue","(not available)");}else{l.setProperty("/_currentContextValue",v);}o.object&&(o.object.value=v);});}}}}}k._private=function(){return{oPopover:z,oSegmentedButton:G,oSettingsButton:N,oDynamicPanel:D,oSettingsPanel:s,oCurrentModel:l,updateCurrentValue:d1,oCurrentInstance:q,oDynamicValueField:u,getMenuItems:function(){return x;},getMenu:function(){return w;}};};return k;});
