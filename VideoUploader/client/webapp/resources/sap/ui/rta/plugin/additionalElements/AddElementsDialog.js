/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/CustomListItem","sap/m/Dialog","sap/m/Label","sap/m/library","sap/m/List","sap/m/SearchField","sap/m/Text","sap/m/ToolbarSpacer","sap/m/Toolbar","sap/m/ScrollContainer","sap/m/VBox","sap/ui/base/ManagedObject","sap/ui/fl/write/api/FieldExtensibility","sap/ui/layout/VerticalLayout","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/rta/Utils"],function(L,B,a,D,b,m,c,S,T,d,e,f,V,M,F,g,J,h,i,j,U){"use strict";var k=m.ButtonType;var l=m.ListType;var n=m.LabelDesign;var A=M.extend("sap.ui.rta.plugin.additionalElements.AddElementsDialog",{metadata:{library:"sap.ui.rta",properties:{customFieldEnabled:{type:"boolean",defaultValue:false},businessContextVisible:{type:"boolean",defaultValue:false},title:{type:"string"}},events:{opened:{},openCustomField:{}}}});A.prototype.init=function(){this._oTextResources=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");this._bAscendingSortOrder=false;this._oDialog=new D().addStyleClass("sapUIRtaFieldRepositoryDialog");this._oDialog.addStyleClass(U.getRtaStyleClassName());this._oDialog.addStyleClass("sapUiNoContentPadding");this._oDialog.setModel(new J({elements:[]}));var C=this._createContent();var o=this._createButtons();C.forEach(function(p){this._oDialog.addContent(p);},this);o.forEach(function(p){this._oDialog.addButton(p);},this);this._oDialog.setInitialFocus(this._oInput);};A.prototype.exit=function(){this._oDialog.destroy();};A.prototype._createContent=function(){this._oInput=new S({width:"100%",liveChange:[this._updateModelFilter,this]});var r=new B({text:"",icon:"sap-icon://sort",press:[this._resortList,this]});this._oCustomFieldButton=new B({text:"",icon:"sap-icon://add",tooltip:"",enabled:this.getCustomFieldEnabled(),press:[this._redirectToCustomFieldCreation,this]});this._oToolbarSpacer1=new d();this.oInputFields=new e({content:[this._oInput,r,this._oToolbarSpacer1,this._oCustomFieldButton]});this._oBCContainer=new g({visible:this.getBusinessContextVisible(),content:[new T({text:""})]}).addStyleClass("sapUIRtaBusinessContextContainer");var o=new b({design:n.Standard,text:{parts:[{path:"label"},{path:"parentPropertyName"},{path:"duplicateName"}],formatter:function(u,P,w){if(w&&P){u+=" ("+P+")";}return u;}}});var p=new b({text:{parts:[{path:"originalLabel"}],formatter:function(O){if(O){return this._oTextResources.getText("LBL_FREP",O);}return"";}.bind(this)},visible:{parts:[{path:"originalLabel"}],formatter:function(O){if(O){return true;}return false;}}});var v=new V();v.addItem(o);v.addItem(p);var s=new j("label",this._bAscendingSortOrder);this._oList=new c({mode:"MultiSelect",includeItemInSelection:true,growing:true,growingScrollToLoad:true}).setNoDataText(this._oTextResources.getText("MSG_NO_FIELDS",this._oTextResources.getText("MULTIPLE_CONTROL_NAME").toLowerCase()));var q=new a({type:l.Active,selected:"{selected}",tooltip:"{tooltip}",content:[v]}).addStyleClass("sapUIRtaListItem");this._oList.bindItems({path:"/elements",template:q,sorter:s,templateShareable:false,key:function(C){switch(C.getProperty("type")){case"invisible":return C.getProperty("elementId");case"odata":return C.getProperty("name");case"delegate":return C.getProperty("name");case"custom":return C.getProperty("key");default:L.error("sap.ui.rta.plugin.additionalElements.AddElementsDialog#_createContent: unsupported data type");}}});var t=new f({content:this._oList,vertical:true,horizontal:false}).addStyleClass("sapUIRtaCCDialogScrollContainer");return[this.oInputFields,this._oBCContainer,t];};A.prototype._createButtons=function(){this._oOKButton=new B({text:this._oTextResources.getText("BTN_FREP_OK"),press:[this._submitDialog,this],type:k.Emphasized});var C=new B({text:this._oTextResources.getText("BTN_FREP_CANCEL"),press:[this._cancelDialog,this]});return[this._oOKButton,C];};A.prototype._submitDialog=function(){this._oDialog.close();this._fnResolve();};A.prototype._cancelDialog=function(){this._oList.removeSelections();this._oDialog.close();this._fnReject();};A.prototype.setElements=function(E){this._oDialog.getModel().setProperty("/elements",E);};A.prototype.getElements=function(){return this._oDialog.getModel().getProperty("/elements");};A.prototype.getSelectedElements=function(){return this._oDialog.getModel().getObject("/elements").filter(function(E){return E.selected;});};A.prototype.open=function(){return new Promise(function(r,o){this._fnResolve=r;this._fnReject=o;this._oDialog.attachAfterOpen(function(){this.fireOpened();}.bind(this));this._oDialog.open();}.bind(this));};A.prototype._resortList=function(){this._bAscendingSortOrder=!this._bAscendingSortOrder;var o=this._oList.getBinding("items");var s=[];s.push(new j("label",this._bAscendingSortOrder));o.sort(s);};A.prototype._updateModelFilter=function(E){var v=E.getParameter("newValue");var o=this._oList.getBinding("items");if((typeof v)==="string"){var p=new h("label",i.Contains,v);var O=new h("originalLabel",i.Contains,v);var P=new h("parentPropertyName",i.Contains,v);var q=new h("duplicateName",i.EQ,true);var r=new h({filters:[P,q],and:true});var s=new h({filters:[p,O,r],and:false});o.filter([s]);}else{o.filter([]);}};A.prototype._redirectToCustomFieldCreation=function(){this.fireOpenCustomField();this._oDialog.close();};A.prototype.setTitle=function(t){M.prototype.setProperty.call(this,"title",t,true);this._oDialog.setTitle(t);};A.prototype.setCustomFieldEnabled=function(C){this.setProperty("customFieldEnabled",C,true);this._oCustomFieldButton.setEnabled(this.getProperty("customFieldEnabled"));};A.prototype._setBusinessContextVisible=function(o){this.setProperty("businessContextVisible",o,true);this._oBCContainer.setVisible(this.getProperty("businessContextVisible"));};A.prototype.getList=function(){return this._oList;};A.prototype.addExtensionData=function(E){this._removeExtensionDataTexts();var o=new T({text:this._oTextResources.getText("MSG_NO_BUSINESS_CONTEXTS")});if(E&&E.length>0){E.forEach(function(C){o=new T({text:C.description});this._oBCContainer.addContent(o);},this);}else{this._oBCContainer.addContent(o);}this._setBusinessContextVisible(true);return F.getTexts().then(function(p){if(p){this._oCustomFieldButton.setTooltip(p.tooltip);this._oBCContainer.getContent()[0].setText(p.headerText);}}.bind(this));};A.prototype._removeExtensionDataTexts=function(){var o;var p=this._oBCContainer.getContent().length;for(o=0;o<p;o++){this._oBCContainer.removeContent(1);}};return A;});
