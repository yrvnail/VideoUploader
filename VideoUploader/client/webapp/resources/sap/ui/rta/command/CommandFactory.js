/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/ui/fl/Utils","sap/ui/fl/Layer","sap/ui/dt/Util","sap/base/util/merge"],function(M,E,O,F,L,D,m){"use strict";function e(A){var B=E.getAggregationInformation(A.getElement());if(B.elementId){var G=O.getOverlay(B.elementId);var P=G.getParentElementOverlay();var H=P?!!E.getAggregationInformation(P.getElement()).templateId:false;if(H){throw D.createError("CommandFactory#evaluateTemplateBinding","Multiple template bindings are not supported","sap.ui.rta");}var T=E.extractTemplateId(B);if(T){return{templateSelector:B.elementId,originalSelector:T,content:{boundAggregation:B.aggregation}};}}return undefined;}function g(A,I){var B=(typeof A==="string")?sap.ui.getCore().byId(A):A;var G=O.getOverlay(B);if(G){var H=E.getAggregationInformation(B);if(typeof I==="number"){H.stack[0].index=I;}return E.extractTemplateId(H);}return B.getId();}function a(A){if(!A){throw new Error("adjustment for template failed");}}function c(A,B,G){var H;var J=false;if(typeof(G)==="string"){H=G;}else{H=G&&G.changeType;J=G&&G.jsOnly;}if(!H){return false;}B.setChangeType(H);B.setJsOnly(J);return true;}function b(A,S,B){var G={changeType:S.name};if(B){jQuery.extend(G,B.getAction(S.name,A));}return G;}function d(S){S.element=sap.ui.getCore().byId(g(S.element));a(S.element);}function f(A,S,B){var N=S.element||sap.ui.getCore().byId(S.element.id);var G=B.getActionDataFromAggregations("createContainer",N)[0];return G;}function h(S){S.element=sap.ui.getCore().byId(g(S.element));a(S.element);S.parentId=g(S.parentId);a(S.parentId);}function i(A,S,B){var G=S.movedElements[0].element||sap.ui.getCore().byId(S.movedElements[0].id);var H=B.getAction("move",G);return H;}function j(S){var T=S.movedElements.map(function(A){var B=sap.ui.getCore().byId(g(A.element,A.sourceIndex));a(B);return B;});S.movedElements.forEach(function(A,B){A.element=T[B];});S.element=sap.ui.getCore().byId(g(S.element));a(S.element);S.source.parent=sap.ui.getCore().byId(g(S.source.parent));a(S.source.parent);S.target.parent=sap.ui.getCore().byId(g(S.target.parent));a(S.target.parent);}function k(A,S,B){return B.getAction("localReset",A);}function l(A,S,B){var R=S.renamedElement;var G=B.getAction("rename",R);return G;}function n(S){S.element=sap.ui.getCore().byId(g(S.element));a(S.element);S.renamedElement=sap.ui.getCore().byId(g(S.renamedElement));a(S.renamedElement);}function o(A,S,B){var R=S.removedElement;if(!R){R=A;}else if(!(R instanceof M)){throw new Error("No valid 'removedElement' found");}var G=B.getAction("remove",R);return G;}function p(S){S.element=sap.ui.getCore().byId(g(S.element));a(S.element);S.removedElement=sap.ui.getCore().byId(g(S.removedElement));a(S.removedElement);}function q(A,S,B){var G=S.source;var H=B.getAction("combine",G);return H;}function r(S){S.element=sap.ui.getCore().byId(g(S.element));a(S.element);S.source=sap.ui.getCore().byId(g(S.source));a(S.source);var T=S.combineElements.map(function(A){A=sap.ui.getCore().byId(g(A));a(A);return A;});S.combineElements=T;}function s(A,S,B){var G=S.source;var H=B.getAction("split",G);return H;}function t(S){S.element=sap.ui.getCore().byId(g(S.element));a(S.element);S.parentElement=sap.ui.getCore().byId(g(S.parentElement));a(S.parentElement);S.source=sap.ui.getCore().byId(g(S.source));a(S.source);}function u(A,S,B){var N=S.element;return B.getAction("add",N,"delegate");}function v(S){S.element=sap.ui.getCore().byId(g(S.element));a(S.element);S.parentId=g(S.parentId);a(S.parentId);}function w(A,S,B){var R=S.element;var G=B.getAction("reveal",R);return G;}function x(S){S.element=sap.ui.getCore().byId(g(S.element));a(S.element);if(S.revealedElementId){S.revealedElementId=g(S.revealedElementId);a(S.revealedElementId);}if(S.directParent){S.directParent=sap.ui.getCore().byId(g(S.directParent));a(S.directParent);}}function y(A,S,B){var G=B.getAction("add",S.element);if(G&&G.custom&&typeof G.custom.getItems==="function"){var H={changeOnRelevantContainer:S.changeOnRelevantContainer,changeType:S.changeType};delete S["changeOnRelevantContainer"];return H;}}var C={composite:{clazz:"sap.ui.rta.command.CompositeCommand",noSelector:true},property:{clazz:"sap.ui.rta.command.Property",adjustForBinding:d},bindProperty:{clazz:"sap.ui.rta.command.BindProperty"},addXML:{clazz:"sap.ui.rta.command.AddXML",configure:b,adjustForBinding:d},addXMLAtExtensionPoint:{clazz:"sap.ui.rta.command.AddXMLAtExtensionPoint",configure:b,adjustForBinding:d},createContainer:{clazz:"sap.ui.rta.command.CreateContainer",configure:f,adjustForBinding:h},move:{clazz:"sap.ui.rta.command.Move",configure:i,adjustForBinding:j},remove:{clazz:"sap.ui.rta.command.Remove",configure:o,adjustForBinding:p},localReset:{clazz:"sap.ui.rta.command.LocalReset",configure:k},rename:{clazz:"sap.ui.rta.command.Rename",configure:l,adjustForBinding:n},addDelegateProperty:{clazz:"sap.ui.rta.command.AddProperty",configure:u,adjustForBinding:v},reveal:{clazz:"sap.ui.rta.command.Reveal",configure:w,adjustForBinding:x},customAdd:{clazz:"sap.ui.rta.command.CustomAdd",configure:y},combine:{clazz:"sap.ui.rta.command.Combine",configure:q,adjustForBinding:r},split:{clazz:"sap.ui.rta.command.Split",configure:s,adjustForBinding:t},"switch":{clazz:"sap.ui.rta.command.ControlVariantSwitch"},save:{clazz:"sap.ui.rta.command.ControlVariantSave"},saveAs:{clazz:"sap.ui.rta.command.ControlVariantSaveAs"},setTitle:{clazz:"sap.ui.rta.command.ControlVariantSetTitle"},configure:{clazz:"sap.ui.rta.command.ControlVariantConfigure"},settings:{clazz:"sap.ui.rta.command.Settings"},addLibrary:{clazz:"sap.ui.rta.command.appDescriptor.AddLibrary",noSelector:true},appDescriptor:{clazz:"sap.ui.rta.command.AppDescriptorCommand",noSelector:true},addIFrame:{clazz:"sap.ui.rta.command.AddIFrame"},compVariantSaveAs:{clazz:"sap.ui.rta.command.compVariant.CompVariantSaveAs"},compVariantSwitch:{clazz:"sap.ui.rta.command.compVariant.CompVariantSwitch"},compVariantUpdate:{clazz:"sap.ui.rta.command.compVariant.CompVariantUpdate"}};function _(A,B,S,G,H,V){B=B[0].toLowerCase()+B.slice(1);var I=C[B];var J=H;if(!I){return Promise.reject(D.createError("CommandFactory#_getCommandFor","Command '"+B+"' doesn't exist, check typing","sap.ui.rta"));}return new Promise(function(R){var K=I.clazz;sap.ui.require([K.replace(/\./g,"/")],function(N){R(N);});}).then(function(K){var N=A instanceof M;if(!I.noSelector){S=Object.assign({},S,!N&&{selector:A});}S=Object.assign({},S,{element:N?A:undefined,name:B});var P;if(I.configure){P=I.configure(A,S,G);}var Q;if(N){Q=O.getOverlay(A);}if(P&&P.changeOnRelevantContainer){Object.assign(S,{element:Q.getRelevantContainer()});A=S.element;Q=O.getOverlay(A);}var T;if(Q&&A.sParentAggregationName){T=e(Q);}if(T){if(I.adjustForBinding){I.adjustForBinding(S);}J=m(T,J);}var R=new K(S);var U=true;if(I.configure){U=c(A,R,P);}if(U){return Promise.resolve().then(function(){return R.prepare(J,V,B);}).then(function(W){if(W){return R;}});}R.destroy();return undefined;});}var z=M.extend("sap.ui.rta.command.CommandFactory",{metadata:{library:"sap.ui.rta",properties:{flexSettings:{type:"object"}},associations:{},events:{}}});z.prototype.init=function(){this.setProperty("flexSettings",{layer:L.CUSTOMER,developerMode:true});};z.prototype.setFlexSettings=function(A){this.setProperty("flexSettings",jQuery.extend(this.getFlexSettings(),A));};z.prototype.getCommandFor=function(A,B,S,G,V){return _(A,B,S,G,this.getFlexSettings(),V);};z.getCommandFor=function(A,B,S,G,H){if(!H){H={layer:L.CUSTOMER,developerMode:true};}if(H.scenario||H.baseId){var I=F.buildLrepRootNamespace(H.baseId,H.scenario,H.projectId);H.rootNamespace=I;H.namespace=I+"changes/";}return _(A,B,S,G,H);};return z;},true);
