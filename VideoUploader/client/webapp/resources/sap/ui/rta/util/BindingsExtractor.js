/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/base/util/isPlainObject"],function(E,O,a){"use strict";function c(o,m,r){var B={bindingPaths:[],bindingContextPaths:[]};var A=o.sParentAggregationName;var p=o.getParent();var n=g(o,m,undefined,undefined,r);if(p){var D=p.getMetadata().getAggregation();if(D){var P=E.getAggregation(p,A).indexOf(o);var s=D.name;var q=p.getBindingInfo(s);var t=q&&q.template;if(t){var T=t.getMetadata().getAggregation();if(T){var u=T.name;var v=E.getAggregation(t,u)[P];n=n.concat(g(v,null,true,undefined,r));}}}}for(var i=0,l=n.length;i<l;i++){if(n[i].getPath){var w=n[i].getPath();if(w&&B.bindingPaths.indexOf(w)===-1){B.bindingPaths.push(w);}}if(n[i].getContext&&n[i].getContext()&&n[i].getContext().getPath){var x=n[i].getContext().getPath();if(x&&B.bindingContextPaths.indexOf(x)===-1){B.bindingContextPaths.push(x);}}if(a(n[i])){if(B.bindingPaths.indexOf(n[i].parts[0].path)===-1){B.bindingPaths.push(n[i].parts[0].path);}}}return B;}function b(o,r){if(r&&o!==r){var i=O.getOverlay(o);var R=i&&(i.getRelevantContainer()||i.getElement());return R?R.getId()===r.getId():true;}return true;}function g(o,p,t,A,r){var B=[];if(b(o,r)){B=(t?j(o):h(o,p));}var i=A?[A]:Object.keys(o.getMetadata().getAllAggregations());i.forEach(function(s){B=B.concat(d(o,p,t,s,r));});return B;}function d(o,p,t,A,r){var B=[];var i=o.getBindingInfo(A);var T=i&&i.template;var l=T?[T]:E.getAggregation(o,A);l.forEach(function(C){if(C.getMetadata){if(b(o,r)){B=B.concat(T||t?j(C,r):h(C,p));}B=B.concat(g(C,p,T||t,undefined,r));}});return B;}function f(B,p){var i=[];var m=B.getMetadata().getName();if(m==="sap.ui.model.CompositeBinding"){B.getBindings().forEach(function(B){i=i.concat(f(B,p));});}else if((m==="sap.ui.model.odata.ODataPropertyBinding"||m==="sap.ui.model.odata.v2.ODataPropertyBinding"||m==="sap.ui.model.odata.v4.ODataPropertyBinding"||m==="sap.ui.model.json.JSONPropertyBinding"||m==="sap.ui.model.json.XMLPropertyBinding"||m==="sap.ui.model.resource.ResourcePropertyBinding")&&B.getModel()===p&&B.isRelative()&&typeof B.getPath==="function"&&B.getPath()){i.push(B);}return i;}function e(B){var i=[];var p=B.parts;p.forEach(function(P){i.push({parts:[P]});});return i;}function h(o,p){var P=Object.keys(o.getMetadata().getAllProperties());return P.filter(o.getBinding.bind(o)).reduce(function(B,s){return B.concat(f(o.getBinding(s),p));},[]);}function j(o){var p=Object.keys(o.getMetadata().getAllProperties());return p.filter(function(P){return P in o.mBindingInfos;}).reduce(function(B,P){return B.concat(e(o.mBindingInfos[P]));},[]);}function k(o){if(o.getBindingContext()&&o.getBindingContext().getPath){return o.getBindingContext().getPath();}return undefined;}return{getBindings:g,collectBindingPaths:c,flattenBindings:f,getBindingsFromProperties:h,getBindingContextPath:k};},true);
