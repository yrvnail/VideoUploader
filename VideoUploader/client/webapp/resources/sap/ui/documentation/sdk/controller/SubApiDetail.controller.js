/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/documentation/sdk/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/documentation/sdk/controller/util/ControlsInfo","sap/ui/documentation/sdk/util/ToggleFullScreenHandler","sap/ui/documentation/sdk/controller/util/APIInfo","sap/ui/documentation/sdk/model/formatter","sap/m/Image","sap/m/Label","sap/m/Link","sap/m/Text","sap/m/HBox","sap/m/ObjectAttribute","sap/m/Popover","sap/m/library","sap/m/CustomListItem","sap/m/List"],function(q,B,J,C,T,A,f,I,L,a,b,H,O,P,l,c,d){"use strict";var F=l.FlexWrap;return B.extend("sap.ui.documentation.sdk.controller.SubApiDetail",{NOT_AVAILABLE:'N/A',PUBLIC_GITHUB_FRAMEWORK_DOMAIN:'https://github.com/SAP/openui5/blob/master/src/',SECTION_MAP:{"properties":"controlProperties","fields":"properties","special settings":"specialsettings"},formatter:f,onInit:function(){this._objectPage=this.byId("apiDetailObjectPage");},initiate:function(r){var h,e,g,o=function(i){return!i.borrowedFrom;};this._sTopicId=r.sTopicId;this._oModel=r.oModel;this._oControlData=this._oModel.getData();this._aApiIndex=r.aApiIndex;this._aAllowedMembers=r.aAllowedMembers;this._sEntityType=r.sEntityType;this._sEntityId=r.sEntityId!=="undefined"?r.sEntityId:undefined;this._oEntityData=r.oEntityData;this._oContainerController=r.oContainerController;this._oContainerView=r.oContainerView;this._oToggleFullScreenBtn=this.byId("toggleFullScreenBtn");this.getOwnerComponent=function(){return r.oOwnerComponent;};this._oRouter=this.getRouter();this._allProperties=this._oModel.getProperty("/ui5-metadata/properties");this._allAggregations=this._oModel.getProperty("/ui5-metadata/aggregations");this._allAssociations=this._oModel.getProperty("/ui5-metadata/associations");if(this._allProperties){this._selfProperties=this._allProperties.filter(o);h=this._selfProperties.length>0;this._oModel.setProperty("/bShowBorrowedProps",!h);this._oModel.setProperty("/bHasSelfProps",h);this._oModel.setProperty("/bHasBorrowedProps",this._allProperties.length>this._selfProperties.length);this._oModel.setProperty("/ui5-metadata/properties",h?this._selfProperties:this._allProperties);}if(this._allAggregations){this._selfAggregations=this._allAggregations.filter(o);e=this._selfAggregations.length>0;this._oModel.setProperty("/bShowBorrowedAggr",!e);this._oModel.setProperty("/bHasSelfAggr",e);this._oModel.setProperty("/bHasBorrowedAggr",this._allAggregations.length>this._selfAggregations.length);this._oModel.setProperty("/ui5-metadata/aggregations",e?this._selfAggregations:this._allAggregations);}if(this._allAssociations){this._selfAssociations=this._allAssociations.filter(o);g=this._selfAssociations.length>0;this._oModel.setProperty("/bShowBorrowedAssoc",!g);this._oModel.setProperty("/bHasSelfAssoc",g);this._oModel.setProperty("/bHasBorrowedAssoc",this._allAssociations.length>this._selfAssociations.length);this._oModel.setProperty("/ui5-metadata/associations",g?this._selfAssociations:this._allAssociations);}if(this._oModel.getProperty("/hasFAQ")){q.ajax({type:"GET",url:'./docs/api/'+this._oEntityData.lib.replace(/\./g,'/')+'/demokit/faq/'+this._oEntityData.displayName+'.html',success:function(i){this._startMonitorFAQSection();this._oModel.setProperty("/faqContent",i);}.bind(this)});}this.setModel(this._oModel);this._oEntityData.appComponent=this._oControlData.component||this.NOT_AVAILABLE;this._oEntityData.hasSample=this._oControlData.hasSample;this._oEntityData.sample=this._oControlData.hasSample?this._sTopicId:this.NOT_AVAILABLE;this._buildHeaderLayout(this._oControlData,this._oEntityData);setTimeout(function(){this._prettify();this._objectPage.attachEvent("subSectionEnteredViewPort",function(){if(this._sPrettyPrintDelayedCallID){clearTimeout(this._sPrettyPrintDelayedCallID);}this._sPrettyPrintDelayedCallID=setTimeout(function(){var $=q('.sapUxAPObjectPageContainer .APIDetailMethodsSection pre:not(.prettyprint)',this._objectPage.$());if($.length>0){$.addClass('prettyprint');window.prettyPrint();}}.bind(this),200);},this);setTimeout(function(){if(this._sEntityType){this._scrollToEntity(this._sEntityType,this._sEntityId);}setTimeout(function(){this._objectPage.attachEvent("_sectionChange",function(E){var s=E.getParameter("section"),S=E.getParameter("subSection");if(this._oNavigatingTo){if(this._oNavigatingTo===S){this._oNavigatingTo=null;}return;}this._modifyURL(s,S,false);},this);this._objectPage.attachEvent("navigate",function(E){var s=E.getParameter("section"),S=E.getParameter("subSection");this._oNavigatingTo=S;this._modifyURL(s,S,true);},this);}.bind(this),500);}.bind(this),1000);}.bind(this),0);this.searchResultsButtonVisibilitySwitch(this.byId("apiDetailBackToSearch"));this.appendPageTitle(this._oModel.getProperty("/displayName"));},onAfterRendering:function(){this.getView().attachBrowserEvent("click",this.onJSDocLinkClick,this);T.updateControl(this._oToggleFullScreenBtn,this._oContainerView,this._oContainerController);},onExit:function(){this.getView().detachBrowserEvent("click",this.onJSDocLinkClick,this);},onToggleFullScreen:function(e){T.updateMode(e,this._oContainerView,this._oContainerController);},onBorrowedPropCheckboxClick:function(e){var g=e.getParameter("selected");this._oModel.setProperty("/bShowBorrowedProps",g);this._oModel.setProperty("/ui5-metadata/properties",g?this._allProperties:this._selfProperties);},onBorrowedAggrCheckboxClick:function(e){var g=e.getParameter("selected");this._oModel.setProperty("/bShowBorrowedAggr",g);this._oModel.setProperty("/ui5-metadata/aggregations",g?this._allAggregations:this._selfAggregations);},onBorrowedAssocCheckboxClick:function(e){var g=e.getParameter("selected");this._oModel.setProperty("/bShowBorrowedAssoc",g);this._oModel.setProperty("/ui5-metadata/associations",g?this._allAssociations:this._selfAssociations);},onJSDocLinkClick:function(e){var o=e.target.classList,j=o.contains("jsdoclink"),E=o.contains("sapUISDKExternalLink"),s=decodeURIComponent(e.target.getAttribute("data-target")),g;if(!j&&!E){return;}if(E){this.onDisclaimerLinkPress(e);return;}if(o.contains("scrollToMethod")){g="methods";}else if(o.contains("scrollToEvent")){g="events";}else if(o.contains("scrollToAnnotation")){g="annotations";}else{return;}this._scrollToEntity(g,s);},_startMonitorFAQSection:function(){var p=this.getView().byId("apiDetailObjectPage"),s=this.getView().byId("faq"),D,n;s.addEventDelegate({ontap:function(e){if(e.target.nodeName==="SUMMARY"&&(D=e.target.parentElement).open){n=p._$spacer.height()+D.offsetHeight;p._$spacer.height(n+"px");}}});},_modifyURL:function(s,S,e){var g=s.getTitle().toLowerCase(),h=(S&&S.getTitle()!=='Overview')?S.getTitle():'';if(Object.keys(this.SECTION_MAP).indexOf(g)>=0){g=this.SECTION_MAP[g];}this._oRouter.navToChangeUrlOnly({id:this._sTopicId,entityType:g,entityId:h},e);},_prettify:function(){q('.sapUxAPObjectPageContainer pre',this._objectPage.$()).addClass('prettyprint');window.prettyPrint();},scrollToMethod:function(e){this._scrollToEntity("methods",e.getSource().getText());},scrollToEvent:function(e){this._scrollToEntity("events",e.getSource().getText());},scrollToAnnotation:function(e){this._scrollToEntity("annotations",e.getSource().getText());},_scrollToEntity:function(s,S){var e,g,o;if(!s){return;}s=s.toLowerCase();o=this.byId(s);if(!o){return;}if(S){S=S.toLowerCase();g=o.getSubSections();e=g.filter(function(h){return h.getTitle().toLowerCase()===S;});if(e.length){this._objectPage.scrollToSection(e[0].getId(),250);}}else{this._objectPage.scrollToSection(o.getId(),250);}},_scrollContentToTop:function(){if(this._objectPage&&this._objectPage.$().length>0){this._objectPage.getScrollDelegate().scrollTo(0,0);}},_getHeaderLayoutUtil:function(){if(!this._oHeaderLayoutUtil){var _=function(t,s){return new O({title:t,text:s}).addStyleClass("sapUiTinyMarginBottom");},e=function(o){return new a(o||{});},g=function(o){return new b(o||{});},h=function(o){return new L(o||{});},i=function(o,j){var k=new H(o||{});if(j){k.addStyleClass("sapUiDocumentationHeaderNavLinks sapUiTinyMarginBottom");}return k;};this._oHeaderLayoutUtil={_getControlSampleBlock:function(o,E){return i({items:[h({design:"Bold",text:"Control Sample:"}),e({emphasized:true,text:E.sample,visible:!!E.hasSample,href:"entity/"+o.name}),g({text:E.sample,visible:!E.hasSample})]},true);},_getControlGithub:function(o,E){return i({items:[h({design:"Bold",text:"GitHub:"}),e({emphasized:true,text:o.resource,visible:true,href:this.PUBLIC_GITHUB_FRAMEWORK_DOMAIN+E.lib+'/src/'+o.resource})]},true);},_getDocumentationBlock:function(o,E){return i({items:[h({design:"Bold",text:"Documentation:"}),e({emphasized:true,text:o.docuLinkText,href:"topic/"+o.docuLink})]},true);},_getUXGuidelinesBlock:function(o){return i({items:[h({design:"Bold",text:"UX Guidelines:"}),e({emphasized:true,text:o.uxGuidelinesLinkText,href:o.uxGuidelinesLink,target:"_blank"}),new I({src:"./resources/sap/ui/documentation/sdk/images/link-sap.png",tooltip:"Information published on SAP site",press:this.onDisclaimerLinkPress})]},true);},_getExtendsBlock:function(o,E){return i({items:[h({text:"Extends:"}),e({text:o.extendsText,href:"api/"+o.extendsText,visible:o.isDerived}),g({text:o.extendsText,visible:!o.isDerived})]},true);},_getSubclassesBlock:function(o,E){var s=E.extendedBy||E.implementedBy,S;this._aSubClasses=s;if(s.length===1){S=e({text:s[0],href:"api/"+s[0]});}else{S=e({text:o.isClass?"View subclasses":"View implementations",press:this._openSubclassesImplementationsPopover.bind(this)});}return i({items:[h({text:o.isClass?"Known direct subclasses:":"Known direct implementations:"}),S]},true);},_getImplementsBlock:function(o,E){var j=[h({text:"Implements:"})];o.implementsParsed.forEach(function(k){j.push(e({text:k.name,href:"api/"+k.href}));});return i({items:j,wrap:F.Wrap},true).addStyleClass("sapUiDocumentationCommaList");},_getModuleBlock:function(o,E){return _("Module",o.module);},_getLibraryBlock:function(o,E){return _("Library",E.lib);},_getVisibilityBlock:function(o,E){return _("Visibility",o.visibility);},_getAvailableSinceBlock:function(o,E){return _("Available since",o.sinceText);},_getApplicationComponentBlock:function(o,E){return _("Application Component",E.appComponent);}};}return this._oHeaderLayoutUtil;},_openSubclassesImplementationsPopover:function(e){var p=this._aSubClasses.map(function(E){return new c({content:[new a({text:E,href:"api/"+E}).addStyleClass("sapUiTinyMargin")]});}),o=this._getSubClassesAndImplementationsPopover(p);o.openBy(e.getSource());},_getSubClassesAndImplementationsPopover:function(e){var p=this._getPopover();if(p.getContent().length>0){p.destroyContent();}if(e&&e.length>0){var o=new d({items:e||[]});p.addContent(o);}return p;},_getPopover:function(){if(!this._oPopover){this._oPopover=new P({placement:"Bottom",showHeader:false});}return this._oPopover;},_buildHeaderLayout:function(o,e){var g=0,S=1,h=2,E=3,i=[[],[],[]],j=this._getHeaderLayoutUtil(),s=e.extendedBy||e.implementedBy||[],k=this.getModel("versionData").getProperty("/isOpenUI5"),m=[{creator:"_getControlSampleBlock",exists:o.isClass||o.isNamespace},{creator:"_getDocumentationBlock",exists:o.docuLink!==undefined},{creator:"_getControlGithub",exists:k&&o.resource&&e.lib},{creator:"_getUXGuidelinesBlock",exists:o.uxGuidelinesLink!==undefined},{creator:"_getExtendsBlock",exists:o.isClass},{creator:"_getSubclassesBlock",exists:s.length>0},{creator:"_getImplementsBlock",exists:o.hasImplementsData},{creator:"_getModuleBlock",exists:true},{creator:"_getLibraryBlock",exists:o.kind==="namespace"&&e.lib},{creator:"_getVisibilityBlock",exists:o.visibility},{creator:"_getAvailableSinceBlock",exists:true},{creator:"_getApplicationComponentBlock",exists:true}],n=function(){var p=0,r,G=function(p){if(p<=E){return g;}else if(p<=E*2){return S;}return h;};m.forEach(function(t){var u;if(t.exists){u=j[t.creator].call(this,o,e);r=G(++p);i[r].push(u);}},this);}.bind(this);n();i.forEach(function(p,r){var v=this.byId("headerColumn"+r);v.removeAllContent();if(p.length>0){v.setVisible(true);p.forEach(v.addContent,v);}},this);},onAnnotationsLinkPress:function(){this._scrollToEntity("annotations","Summary");},backToSearch:function(){this.onNavBack();}});});
