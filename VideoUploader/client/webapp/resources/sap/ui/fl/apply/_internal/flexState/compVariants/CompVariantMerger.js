/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexObjects/CompVariant","sap/base/Log"],function(C,L){"use strict";var c={addFavorite:function(v){v.setFavorite(true);},removeFavorite:function(v){v.setFavorite(false);},updateVariant:function(v,o){var e=o.getContent();if(e.executeOnSelection!==undefined){v.setExecuteOnSelection(e.executeOnSelection);}if(e.favorite!==undefined){v.setFavorite(e.favorite);}if(e.contexts){v.setContexts(e.contexts);}if(e.variantContent){v.setContent(e.variantContent);}var V=o.getText("variantName");if(V){v.setName(V);}}};function g(m){var e={};m.changes.forEach(function(o){var v=o.getSelector().variantId||o.getContent().key;if(!e[v]){e[v]=[];}e[v].push(o);});return e;}function l(v,o){L.error("No change handler for change with the ID '"+o.getId()+"' and type '"+o.getChangeType()+"' defined.\n"+"The variant '"+v.getId()+"'was not modified'");}function a(p,v){var V={fileName:v.id||C.STANDARD_VARIANT_ID,persisted:v.persisted,content:v.content||{},texts:{variantName:{value:v.name||""}},selector:{persistencyKey:p}};if(v.favorite!==undefined){V.favorite=v.favorite;}if(v.executeOnSelection!==undefined){V.executeOnSelection=v.executeOnSelection;}return new C(V);}function b(v,o){var e=c[o.getChangeType()]||l;e(v,o);v.addChange(o);}function d(m,v){var V=v.getId();if(m[V]){m[V].forEach(function(o){b(v,o);});}}return{merge:function(p,m,s){var v=m.nonPersistedVariants.concat(m.variants);var e=g(m);v.forEach(d.bind(undefined,e));var S;v.forEach(function(V){if(V.getContent()&&V.getContent().standardvariant){S=V;}});if(!S){S=a(p,s);}else{v=v.filter(function(V){return!V.getContent()||!V.getContent().standardvariant;});}d(e,S);S.setFavorite(true);S.setStandardVariant(true);m.byId[S.getId()]=S;var o=m.standardVariantChange;if(o){var E=o.getContent().executeOnSelect;S.addChange(o);S.setExecuteOnSelection(E);S.getContent().executeOnSelect=E;}m.standardVariant=S;return{standardVariant:S,variants:v};},createVariant:function(p,v){return a(p,v);},applyChangeOnVariant:b};});
