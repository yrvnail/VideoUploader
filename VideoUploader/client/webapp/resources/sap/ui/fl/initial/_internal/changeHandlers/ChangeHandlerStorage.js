/*!
* OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/base/util/each","sap/base/Log","sap/ui/fl/registry/ChangeRegistryItem","sap/ui/fl/registry/Settings","sap/ui/fl/requireAsync"],function(e,L,C,S,r){"use strict";var a={};var R={};var A={};var p={};function b(s,v){var o={};if(!v||!v.changeHandler){o.changeHandler=v;}else{o=v;}if(o.changeHandler==="default"){o.changeHandler=p.defaultChangeHandlers[s];}else if(Object.keys(p.developerChangeHandlers).includes(s)){throw Error("You can't use a custom change handler for the following Developer Mode change type: "+s+". Please use 'default' instead.");}return o;}function c(D){A={};e(D,function(s,o){var h=new C({controlType:"defaultActiveForAll",changeHandler:o,layers:S.getDeveloperModeLayerPermissions(),changeType:s});A[s]=h;});}function d(s,h,o){var l=Object.assign({},S.getDefaultLayerPermissions());if(o.layers){e(o.layers,function(i,j){if(l[i]===undefined){throw Error("The Layer '"+i+"' is not supported. Please only use supported layers");}l[i]=j;});}var P={controlType:s,changeHandler:o.changeHandler,layers:l,changeType:h};return new C(P);}function f(s,h,o){var i=d(s,h,o);R[s]=R[s]||{};R[s][h]=i;}function g(s,m){var P=Promise.resolve(m);var h="ChangeHandlerStorage.registerChangeHandlersForControl.skip_next_then";if(typeof m==="string"){P=r(m+".flexibility").catch(function(E){L.error("Flexibility change handler registration failed.\nControlType: "+s+"\n"+E.message);return Promise.resolve(h);});}return P.then(function(v){if(v!==h){e(v,function(i,j){var o=b(i,j);f(s,i,o);});}}).catch(function(E){L.error(E.message);});}a.registerPredefinedChangeHandlers=function(D,m){p.defaultChangeHandlers=D;p.developerChangeHandlers=m;c(m);};a.registerChangeHandlersForLibrary=function(m){var P=[];e(m,function(s,v){P.push(g(s,v));});return Promise.all(P);};a.getRegistryItem=function(s,h){return R[s]&&R[s][h];};a.getDeveloperModeChangeChangeRegistryItem=function(s){return A[s];};a.isChangeHandlerRegistered=function(s,h){return Object.keys(R[s]||{}).includes(h);};a.clearAll=function(){R={};A={};p={};};a.registerChangeHandlersForControl=function(s,m){return g(s,m);};return a;});
