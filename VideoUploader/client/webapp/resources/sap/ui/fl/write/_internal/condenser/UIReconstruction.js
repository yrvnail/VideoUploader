/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_isEqual","sap/base/util/each","sap/ui/fl/write/_internal/condenser/classifications/Create","sap/ui/fl/write/_internal/condenser/classifications/Destroy","sap/ui/fl/write/_internal/condenser/classifications/Move","sap/ui/fl/write/_internal/condenser/Utils"],function(_,e,C,D,M,U){"use strict";var d={};var I={create:C,destroy:D,move:M};function f(a,c){e(a,function(O,b){e(b,function(r,t){c(b,O,t,r);});});}function s(E,O,N){E.splice(N,0,E.splice(O,1)[0]);}function g(a,c){var b={};f(a,function(r,t,v,A){var T=v[U.TARGET_UI];T.forEach(function(w){c.forEach(function(x){if(w===x.affectedControl){if(!b[t]){b[t]={};}var y=b[t];if(!y[A]){y[A]=[];}var z=y[A];z.push(x);}});});});return b;}function h(c){return!c.some(function(E){return E.classification!==sap.ui.fl.condenser.Classification.Create;});}function i(E){return!E.some(function(v){return U.isUnknown(v);});}function j(c){return c.getTargetIndex(c.change);}function k(c){c.sort(function(a,b){var r=j(a);var N=j(b);return r-N;});}function l(E){return!E.some(function(v){return!U.isUnknown(v);});}function m(a,c){var b=c.targetContainer;var A=c.affectedControl;var t=c.getTargetIndex(c.change);var r=a[b][c.targetAggregation];U.extendArrayWithPlaceholders(r,undefined,t);var S=r.indexOf(A);s(r,S,t);}function n(a,b){var c;if(a.length<b.length){c=b.slice(a.length);if(!l(c)){return false;}b=b.slice(0,a.length);}else if(a.length>b.length){c=a.slice(b.length,a.length);if(!l(c)){return false;}a=a.slice(0,b.length);}return _(a,b);}function o(c,a,b,t,r){var v={};r.forEach(function(w){var c=w.targetContainer;if(!v[c]){v[c]={};}var x=v[c];if(!x[a]){x[a]=U.initializeArrayWithPlaceholders(0,b.length-1);}I[w.classification].simulate(x[a],w,b);});r.forEach(function(w){if(w.classification===sap.ui.fl.condenser.Classification.Move){m(v,w);}});var S=v[c][a];if(n(t,S)){return true;}return false;}function u(r,a){f(a,function(b,c,t){t[U.TARGET_UI].forEach(function(T,v){if(!U.isUnknown(T)){var w=r[T];var S=w[U.INDEX_RELEVANT];e(S,function(x,y){if(x!==sap.ui.fl.condenser.Classification.Destroy){y.forEach(function(z){z.setTargetIndex(z.change,v);z.change.condenserState="select";});}});}});});}function p(r,a){f(a,function(b,c,t,K){var v=t[U.INITIAL_UI];var T=t[U.TARGET_UI];if(n(v,T)){T.forEach(function(w){var x=r[w];if(x!==undefined){e(x[U.INDEX_RELEVANT],function(y,z){z.forEach(function(A){A.change.condenserState="delete";});});delete x[U.INDEX_RELEVANT];}});delete b[K];}});}function q(r,a){f(a,function(b,c,t){var v=t[U.INITIAL_UI];var T=t[U.TARGET_UI];v.forEach(function(w,x){var y=r[w];if(!y||!y[U.INDEX_RELEVANT]){var P=U.PLACEHOLDER+x;var z=T.indexOf(w);if(z>=0){T[z]=P;}}});});}d.swapChanges=function(S,a){var b=S.map(function(c){return a.indexOf(c);}).sort();S.forEach(function(c){a[b.shift()]=c;});};d.sortIndexRelatedChanges=function(a,c){var S=[];var b=g(a,c);f(b,function(A,r,c,t){var T=a[r][t][U.TARGET_UI];var v=a[r][t][U.INITIAL_UI];if(i(T)||h(c)){k(c);}else if(!o(r,t,v,T,c)){var w=false;var x=c.length;while(x!==0&&!w){var O=0;var N=1;while(N<c.length&&!w){s(c,O,N);w=o(r,t,v,T,c);O++;N++;}x--;}}c.forEach(function(y){S=S.concat(y.change);});});return S;};d.addChange=function(a,c){I[c.classification].addToReconstructionMap(a,c);};d.compareAndUpdate=function(r,a){p(r,a);q(r,a);u(r,a);};return d;});
