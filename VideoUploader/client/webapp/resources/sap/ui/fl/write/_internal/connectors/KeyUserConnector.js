/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils"],function(m,B,I,a,W){"use strict";var P="/flex/keyuser";var A="/v1";function _(p){p.initialConnector=I;p.xsrfToken=I.xsrfToken;p.tokenUrl=K.ROUTES.TOKEN;}function b(p){var o={title:p.title};p.payload=JSON.stringify(o);p.dataType="json";p.contentType="application/json; charset=utf-8";}function r(v){v.version=v.versionNumber;delete v.versionNumber;return v;}var K=m({},B,{layers:I.layers,ROUTES:{CHANGES:P+A+"/changes/",SETTINGS:P+A+"/settings",TOKEN:P+A+"/settings",VERSIONS:{GET:P+A+"/versions/",ACTIVATE:P+A+"/versions/activate/",DISCARD:P+A+"/versions/draft/"}},isLanguageInfoRequired:true,loadFeatures:function(p){return B.loadFeatures.call(K,p).then(function(f){f.isPublicLayerAvailable=f.isPublicLayerAvailable&&!f.isVariantAdaptationEnabled;return f;});}});K.versions={load:function(p){_(p);var c={};a.addLanguageInfo(c);c.limit=p.limit;var v=a.getUrl(K.ROUTES.VERSIONS.GET,p,c);return a.sendRequest(v,"GET",p).then(function(R){return R.response.map(function(V){return r(V);});});},activate:function(p){_(p);b(p);var c={version:p.version};a.addLanguageInfo(c);var v=a.getUrl(K.ROUTES.VERSIONS.ACTIVATE,p,c);return W.sendRequest(v,"POST",p).then(function(R){var V=R.response;return r(V);});},discardDraft:function(p){_(p);var v=a.getUrl(K.ROUTES.VERSIONS.DISCARD,p);return W.sendRequest(v,"DELETE",p);}};K.initialConnector=I;return K;});
